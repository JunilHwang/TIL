<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
      if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true)
      }
    </script>
    <meta name="google-site-verification" content="sHfBWIoCUOYFXJ3b0ulN8jp9jpD8SEW5Wpxvlk-UABA"><link rel="apple-touch-icon" sizes="180x180" href="/TIL/assets/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/TIL/assets/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/TIL/assets/favicons/favicon-16x16.png"><link rel="manifest" href="/TIL/manifest.webmanifest"><link rel="mask-icon" href="/TIL/assets/favicons/safari-pinned-tab.svg" color="#3a0839"><link rel="shortcut icon" href="/TIL/assets/favicons/favicon.ico"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+KR&display=swap"><meta name="msapplication-TileColor" content="#3a0839"><meta name="msapplication-config" content="/TIL/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="alternate" type="application/atom+xml" href="https://junilhwang.github.io/TIL/TIL/atom.xml" title="개발자 황준일 Atom Feed"><link rel="alternate" type="application/json" href="https://junilhwang.github.io/TIL/TIL/feed.json" title="개발자 황준일 JSON Feed"><link rel="alternate" type="application/rss+xml" href="https://junilhwang.github.io/TIL/TIL/rss.xml" title="개발자 황준일 RSS Feed"><title>MVVM System 개선하기 (1) | 개발자 황준일</title><meta name="description" content="다양한 Design Pattern을 이용하여 MVVM System을 개선하는 방법에 대해 소개합니다.">
    <link rel="preload" href="/TIL/assets/style-BIBOH9ax.css" as="style"><link rel="stylesheet" href="/TIL/assets/style-BIBOH9ax.css">
    <link rel="modulepreload" href="/TIL/assets/app-5lrBuCb5.js"><link rel="modulepreload" href="/TIL/assets/index.html-CpDLrkno.js">
    <link rel="prefetch" href="/TIL/assets/index.html-CTfZjQHb.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-D6SVLQ0c.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-ChsIJ9Us.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-BsqGTI8M.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-GKteHYh_.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-C6xs1old.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-CEY268Or.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-BWlWtmYa.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-j7Ast6wZ.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-xCXyHcVX.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-pzL7C7IS.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-Bbg07MjG.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-CpXXALDk.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-DgYcrH7M.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-CHUjlfVa.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-C7kdu8Mv.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-BmWEjDof.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-Bk_pTykZ.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-A4xWCaNb.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-v1e2npSb.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-BLuIIrNY.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-BZqTqKaq.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-CDhNmYrf.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-Cq3xkvrK.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-Bv2BZ9sy.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-CvPTLPgf.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-BB5RGboM.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-CI58MQeS.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-BfVG_qap.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-Bxn8gYIK.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-DMfThM5d.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-wZ3Qg1xW.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-CokWc5JU.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-tgO43aNq.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-DPPghBqC.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-CYUXriKb.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-CutxbpXG.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-DboWx4OU.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-CHGuDAXZ.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-DuLRk8q8.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-BQEQ7FDV.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-B0Mg4Y_t.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-BFS0bM1I.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-nJmGPAk9.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-Ds3Wq_Sk.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-KYoM6Kxo.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-BWl5silW.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-B8M3TTAk.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-CTg1Fep5.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-g8Wloiqr.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-AjzwWJQH.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-Cz6aX4uz.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-CbcVNWuM.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-BYt3k-te.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-C_L65L7H.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-Cv29RIGW.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-DrnbPwVL.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-Ct3p-llX.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-NS1CgKex.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-xfQFHrSX.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-D7DUYmDT.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-kni63MSF.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-hcAm5Nz_.js" as="script"><link rel="prefetch" href="/TIL/assets/index.html-CfomNeGx.js" as="script"><link rel="prefetch" href="/TIL/assets/404.html-B4kXyAz2.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/TIL/"><img class="logo" src="https://avatars1.githubusercontent.com/u/18749057?s=460&amp;v=4" alt="개발자 황준일"><span class="site-name can-hide" aria-hidden="true">개발자 황준일</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="route-link" href="/TIL/" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/TIL/About/" aria-label="About"><!--[--><!--]--> About <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="route-link" href="/TIL/" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/TIL/About/" aria-label="About"><!--[--><!--]--> About <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">MVVM System 개선하기 (1) <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="#strategy-pattern" aria-label="Strategy Pattern"><!--[--><!--]--> Strategy Pattern <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="#defined" aria-label="Defined"><!--[--><!--]--> Defined <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#strategy-분석-및-추출" aria-label="Strategy 분석 및 추출"><!--[--><!--]--> Strategy 분석 및 추출 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#dependency-injection" aria-label="Dependency Injection"><!--[--><!--]--> Dependency Injection <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#정리" aria-label="정리"><!--[--><!--]--> 정리 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link sidebar-item" href="#observer-pattern" aria-label="Observer Pattern"><!--[--><!--]--> Observer Pattern <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="#listener" aria-label="Listener"><!--[--><!--]--> Listener <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#viewmodel" aria-label="ViewModel"><!--[--><!--]--> ViewModel <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#composite" aria-label="Composite"><!--[--><!--]--> Composite <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#observer" aria-label="Observer"><!--[--><!--]--> Observer <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link sidebar-item" href="#client" aria-label="Client"><!--[--><!--]--> Client <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="#전체-코드" aria-label="전체 코드"><!--[--><!--]--> 전체 코드 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link sidebar-item" href="#summary" aria-label="Summary"><!--[--><!--]--> Summary <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--[--><div class="hit"><img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https://junilhwang.github.io/TIL/CodeSpitz/Object-Oriented-Javascript/03-Strategy-Observer/&amp;count_bg=%230099FF&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=%EC%A1%B0%ED%9A%8C%EC%88%98&amp;edge_flat=true" alt="Hits bn"></div><!--]--><!--]--><div><h1 id="mvvm-system-개선하기-1" tabindex="-1"><a class="header-anchor" href="#mvvm-system-개선하기-1"><span>MVVM System 개선하기 (1)</span></a></h1><div class="custom-container tip"><p class="custom-container-title">해당 포스트는 아래의 내용들을 토대로 정리한 것입니다.</p><p><a href="https://www.youtube.com/watch?v=D450fPGffTg" target="_blank" rel="noopener noreferrer">코드스피츠 86기 3회차 동영상<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><p>Strategy, Observer, Composite 등의 Design Pattern 을 이용하여 <a href="CodeSpitz/Object-Oriented-Javascript/02-MVVM">앞서 작성한 MVVM System</a>을 개선하는 방법에 대해 기술합니다.</p><h2 id="strategy-pattern" tabindex="-1"><a class="header-anchor" href="#strategy-pattern"><span>Strategy Pattern</span></a></h2><p><code>Strategy(전략)</code>이란 쉽게 말해서 프로그램의 핵심적인 부분을 의미한다.</p><h3 id="defined" tabindex="-1"><a class="header-anchor" href="#defined"><span>Defined</span></a></h3><ul><li>목적을 달성하기 위해 일을 수행하는 방식, 비즈니스 규칙, 문제를 해결하는 알고리즘 등</li><li>Stategy Pattern: <strong>전략을 쉽게 바꿀 수 있도록</strong> 해주는 디자인 패턴</li><li><strong>같은 문제를 해결하는 여러 알고리즘</strong>이 클래스별로 캡슐화되어 있고 이들이 필요할 때 교체할 수 있도록 함</li></ul><img src="https://www.plantuml.com/plantuml/svg/SoWkIImgAStDuShCAqajIajCJbK8BYbAB4bDh-HopWUALPGeQEd2nHIi5A2YRwPFUDCo1oxnUkaUXJTDQzxCMlbswfpNtKlqkE1QR6fqTHMKNcrTytP6ovjDMmoLu9eySmjoKdDJGJOR6EBKO8HTWn6NGsfU2j3f0000" alt="uml diagram"><h3 id="strategy-분석-및-추출" tabindex="-1"><a class="header-anchor" href="#strategy-분석-및-추출"><span>Strategy 분석 및 추출</span></a></h3><p>앞서 작성한 MVVM System의 <code>Binder</code>를 분해해보면 다음과 같다.</p><ul><li><p>먼저 Binder에 대한 <code>Structure(자료구조)</code> 부분이다.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> Binder <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">  #items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line highlighted">  <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> BinderItem<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#items<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line highlighted">  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter">viewmodel<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>viewmodel<span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">    <span class="token keyword">this</span><span class="token punctuation">.</span>#items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">      <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>viewmodel<span class="token punctuation">[</span>item<span class="token punctuation">.</span>viewmodel<span class="token punctuation">]</span><span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span><span class="token punctuation">,</span> el <span class="token operator">=</span> item<span class="token punctuation">.</span>el</span>
<span class="line">      Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>styles<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">.</span>style<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">)</span></span>
<span class="line">      Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">.</span>attribute<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">)</span></span>
<span class="line">      Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>properties<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">)</span></span>
<span class="line">      Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>events<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">on</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>k<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">v</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> e<span class="token punctuation">,</span> viewmodel<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>자료구조</code>를 <code>Control(제어)</code>하는 부분이다.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> Binder <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span></span>
<span class="line">  #items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> BinderItem<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#items<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter">viewmodel<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>viewmodel<span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>#items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>viewmodel<span class="token punctuation">[</span>item<span class="token punctuation">.</span>viewmodel<span class="token punctuation">]</span><span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span><span class="token punctuation">,</span> el <span class="token operator">=</span> item<span class="token punctuation">.</span>el</span>
<span class="line highlighted">      Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>styles<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">.</span>style<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">)</span></span>
<span class="line highlighted">      Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">.</span>attribute<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">)</span></span>
<span class="line highlighted">      Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>properties<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">)</span></span>
<span class="line highlighted">      Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>events<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">on</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>k<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">v</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> e<span class="token punctuation">,</span> viewmodel<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>마지막으로 Binder의 핵심인 <code>Strategy(전략,알고리즘)</code>에 해당하는 부분이다.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> Binder <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span></span>
<span class="line">  #items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> BinderItem<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#items<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter">viewmodel<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>viewmodel<span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>#items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>viewmodel<span class="token punctuation">[</span>item<span class="token punctuation">.</span>viewmodel<span class="token punctuation">]</span><span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span><span class="token punctuation">,</span> el <span class="token operator">=</span> item<span class="token punctuation">.</span>el</span>
<span class="line">      Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>styles<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span></span>
<span class="line highlighted">        <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">.</span>style<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v</span>
<span class="line">      <span class="token punctuation">)</span></span>
<span class="line">      Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span></span>
<span class="line highlighted">        <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">.</span>attribute<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v</span>
<span class="line">      <span class="token punctuation">)</span></span>
<span class="line">      Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>properties<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span></span>
<span class="line highlighted">        <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v</span>
<span class="line">      <span class="token punctuation">)</span></span>
<span class="line">      Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>events<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span></span>
<span class="line highlighted">        <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">on</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>k<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">v</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> e<span class="token punctuation">,</span> viewmodel<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><code>Strategy</code>는 <code>Structure</code>를 가지고 있어야 작동하는데 이 때 <code>Composite Pattern</code>을 이용하여 해결한다. Strategy Pattern을 사용한다는 것은 <strong>알고리즘이 사용된 Code를 object(객체)로 바꾸는 것</strong>이라고 할 수 있다. 그리고 이 때 <strong>Binder는 Strategy에 대한 Dependency</strong>가 생기게 된다.</p><h3 id="dependency-injection" tabindex="-1"><a class="header-anchor" href="#dependency-injection"><span>Dependency Injection</span></a></h3><div class="custom-container tip"><p class="custom-container-title">Dependency가 발생하는 이유와 Dependency Injection</p><p>객체지향에서는 자신이 가지고 있는 문제를 외부에 있는 객체의 도움(Strategy)을 통해 해결하기 때문에 자연스럽게 Dependency가 생기게 된다. 반대로 외부 객체의 도움이 없다면 스스로 문제를 해결해야 한다는 것인데, 그 의미는 코드의 수정이 빈번하게 일어난다는 것이다.</p><p>의존성이 생겼을 때 내부에 <code>Sub Type</code>을 만드는 경우가 있고, 외부에서 <code>Type을 공급(Injection)</code> 받는 경우가 있다. Sub Type 사용시 계속에서 code를 수정 하게 되기 때문에 code에서 object로 변경한 의미가 없어지게 된다. 따라서 type은 외부에서 주입 받아야 한다. 이것을 <code>DI(Dependency Injection)</code> 라고 한다. 그래서 Strategy를 도출하는 순간 자동으로 <code>Dependency Injection</code>이 생기게 된다. <strong>반대로 Dependency는 있는데 DI가 생기지 않았다면 그것은 잘못된 것이다.</strong></p></div><p>이제 Binder의 Strategy가 무엇인지 알았으니 이것을 <strong>추출하여 위임</strong> 해야 한다. <strong>이러한 행위를 <code>Composition</code>이라고 한다.</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token comment">// Binder의 Strategy가 될 Class</span></span>
<span class="line"><span class="token keyword">const</span> Processor <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span></span>
<span class="line">  category<span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">category</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>category <span class="token operator">=</span> category</span>
<span class="line">    Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// template method</span></span>
<span class="line">  <span class="token function">process</span> <span class="token punctuation">(</span>vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">,</span> _0 <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                         _1 <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> HTMLElement<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                         _2 <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_process</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// hook method</span></span>
<span class="line">  <span class="token function">_process</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token string">&#39;override&#39;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>코드를 보면 <strong>process method의 책임을 _process method에게 위임</strong>한다. 이 때 processor class를 상속 받아서 _process를 구현 하게 되는 데, <em>구현되는 method(_process)</em> 를 <code>Hook Method</code>라고 한고, <em>Hook method(_proces)에게 책임을 위임하게 되는 method(process)</em> 를 <code>Template Method</code> 라고 한다.</p><p>이것을 Template Method Pattern 이라고 한다. 자세한 내용은 <a href="https://gmlwjd9405.github.io/2018/07/13/template-method-pattern.html" target="_blank" rel="noopener noreferrer">여기<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>를 참고하면 된다.</p><hr><ul><li><p><code>process</code></p><ul><li>Template method</li><li>Hook Method에게 책임을 위임한다.</li></ul></li><li><p><code>_process</code></p><ul><li>Hook method</li><li>template method에서 호출되는 method</li></ul></li></ul><hr><p><code>Processor</code>를 작성했으면, <code>Binder</code>를 수정해야 한다.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> Binder <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span></span>
<span class="line">  #item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span></span>
<span class="line highlighted">  #processors <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">// category당 한 개의 processor를 사용하게 하기 위함</span></span>
<span class="line highlighted">                    <span class="token comment">// 자료구조를 선택할 때 심각하게 생각해야 한다.</span></span>
<span class="line">                    </span>
<span class="line">  <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> BinderItem<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#item<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line highlighted">  <span class="token comment">// Strategy를 주입 받는다.</span></span>
<span class="line highlighted">  <span class="token function">addProcessor</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> Processor<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#processors<span class="token punctuation">[</span>v<span class="token punctuation">.</span>category<span class="token punctuation">]</span> <span class="token operator">=</span> v <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// Render에서 주입 받은 Strategy를 사용한다.</span></span>
<span class="line">  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter">viewmodel<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>viewmodel<span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> processores <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#processors<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>#item<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>viewmodel<span class="token punctuation">[</span>item<span class="token punctuation">.</span>viewmodel<span class="token punctuation">]</span><span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span><span class="token punctuation">,</span> el <span class="token operator">=</span> item<span class="token punctuation">.</span>el</span>
<span class="line highlighted">      processores<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>pk<span class="token punctuation">,</span> processor<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">        Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>vm<span class="token punctuation">[</span>pk<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">          processor<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line highlighted">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line highlighted">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">알고리즘의 일반화(Generic Algorithm)</p><ul><li>structure를 남기고 Strategy을 type으로 내보낸다.</li><li>Binder는 processor의 protocal을 알고 있다 = 의존성이 생긴 것</li><li>이러한 과정을 <strong>알고리즘의 일반화(Generic Algorithm)라고 함</strong> → 제일 어려운 부분</li><li>안정된 Generic Algorithm은 protocal이 적다 → 만들기가 어렵다.</li></ul></div><p>그리고 Strategy를 주입하는 Client Code는 다음과 같다.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">binder<span class="token punctuation">.</span><span class="token function">addProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">class</span> <span class="token keyword">extends</span> <span class="token class-name">Processor</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">  <span class="token function">_process</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> el<span class="token punctuation">.</span>style<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token string">&#39;styles&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">binder<span class="token punctuation">.</span><span class="token function">addProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">class</span> <span class="token keyword">extends</span> <span class="token class-name">Processor</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">  <span class="token function">_process</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token string">&#39;attributes&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">binder<span class="token punctuation">.</span><span class="token function">addProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">class</span> <span class="token keyword">extends</span> <span class="token class-name">Processor</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">  <span class="token function">_process</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> el<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token string">&#39;properties&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">binder<span class="token punctuation">.</span><span class="token function">addProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">class</span> <span class="token keyword">extends</span> <span class="token class-name">Processor</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">  <span class="token function">_process</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> el<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">on</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>k<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">v</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> e<span class="token punctuation">,</span> vm<span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token string">&#39;events&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="https://www.plantuml.com/plantuml/svg/SoWkIImgAStDuKfEB4fHSChCIqajWh03YlAJKukByuku8A8AkdPs2445AmMNr89Ke4HUSgM2PrvMQd99PduUbmDG26WS0000" alt="uml diagram"><ul><li>Binder가 Processor를 주입 받는다</li><li>의존성은 단 방향으로만 되어있어야 한다.</li><li><s>Binder가 Processor를 짝사랑한다.</s></li></ul><h3 id="정리" tabindex="-1"><a class="header-anchor" href="#정리"><span>정리</span></a></h3><ul><li>구조적인 부분과 strategy 부분을 나눈다.</li><li>strategy의 공통점을 찾는다.</li><li>strategy와 어떻게 상태와 관계를 맺는지 찾는다.</li><li>앞에서 도출된 형(type,class,interface)을 가지고 알고리즘을 고치는 것</li></ul><h2 id="observer-pattern" tabindex="-1"><a class="header-anchor" href="#observer-pattern"><span>Observer Pattern</span></a></h2><p>기존에는 Observer 대신에 Call을 사용했다.</p><img src="https://www.plantuml.com/plantuml/svg/SoWkIImgAStDuIfAJIv9p4lFILK8oqmjH-8wPUQbf1OX2VZcfwJcS2Mcf-QLWDL2-5mWfe9kT4PcIafgNYnK5LZGnaPN5sOCX089sTaXT2jOAMXf9IVcv6XfSK44m7eGfaC4TL4qSJcavgK0dGu0" alt="uml diagram"><p>이제 Call을 이용하는 방식에서 Observer Pattern을 이용하는 방식으로 바꿔야 한다.</p><img src="https://www.plantuml.com/plantuml/svg/SoWkIImgAStDuIfAJIv9p4lFILK8oqmjH-8wPUQbf1OX2VZcfwJcS2Mcf-QLWDL2-5mWfe9kT4PcIafgNYnK5LZGnaPN5sOCX5BGjRD3w5MmKl1FAaujAak5IGDre4ZxvPTafbLoGRXWun0MGmHrKKpaSaZDIm7w2W00" alt="uml diagram"><p>Observer Pattern에서 중요한 점은 <strong>감시 당하는 쪽(Subject)이 변화가 생기면 Observer(Listener)에게 변화의 내용을 알려줘야 한다(Notify).</strong></p><p>Javascript는 변화의 감지를 위해 사용하는 다음과 같은 API가 있다.</p><ul><li><code>Proxy</code> : Babel로 Converting이 되지 않는다 = 실무에서 사용할 때 제약이 있다.</li><li><code>defineProperty</code> : ES5 까지 지원한다 = 실무 상에서 사용할 수 있다.</li></ul><p>이러한 이유로 defineProperty를 이용하여 만들어볼 것이다.</p><h3 id="listener" tabindex="-1"><a class="header-anchor" href="#listener"><span>Listener</span></a></h3><p>일단 변화의 감지에 대한 내용을 수신하는 객체가 필요하다.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> ViewModelListener <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">viewmodelUpdated</span><span class="token punctuation">(</span><span class="token parameter">updated</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">throw</span> <span class="token string">&#39;override&#39;</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Listener는 Binder와 ViewModel이 상속 받아 사용할 것이다.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> Binder <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> ViewModelListner <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// .. 생략</span></span>
<span class="line">  <span class="token function">viewmodelUpdated</span> <span class="token punctuation">(</span><span class="token parameter">updated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> ViewModel <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> ViewModelListner <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// .. 생략</span></span>
<span class="line">  <span class="token function">viewmodelUpdated</span> <span class="token punctuation">(</span><span class="token parameter">updated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ViewModel에도 Listener가 필요한 이유는, <u>자식의 변화를 부모가 알아야 하기 때문이다.</u></p><h3 id="viewmodel" tabindex="-1"><a class="header-anchor" href="#viewmodel"><span>ViewModel</span></a></h3><p>ViewModel에서 notify는</p><p><code>Object.defineProperty</code>는 객체에 직접 새로운 속성을 정의하거나 이미 존재하는 속성을 수정한 후 그 객체를 반환한다.</p><p><code>Parameter</code>는 다음과 같다.</p><ul><li><code>obj</code> 속성을 정의할 객체</li><li><code>prop</code> 새로 정의하거나 수정하려는 속성의 이름</li><li><code>descriptor</code> 새로 정의하거나 수정하려는 속성을 기술하는 객체 <ul><li><code>enumerable</code> iterator에 노출 가능 여부(true|false)</li><li><code>get</code> prop에 대한 getter</li><li><code>set</code> prop에 대한 setter</li></ul></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> ViewModel <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> ViewModelListener <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">ViewModel</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token function-variable function">descriptor</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">,</span></span>
<span class="line highlighted">    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token parameter">newV</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">      <span class="token comment">// 값을 대체 후, isUpdated에 등록하고, listener에게 변경된 내역이 전달된다.</span></span>
<span class="line highlighted">      v <span class="token operator">=</span> newV</span>
<span class="line highlighted">      vm<span class="token punctuation">.</span>#isUpdated<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ViewModelValue</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>subKey<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line highlighted">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token function-variable function">defineProperties</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> category<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span></span>
<span class="line">    Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span></span>
<span class="line">      obj<span class="token punctuation">,</span></span>
<span class="line">      Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r<span class="token punctuation">,</span> <span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>r<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> ViewModel<span class="token punctuation">.</span><span class="token function">descriptor</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  styles<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> attributes<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> properties<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> events<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  #isUpadated <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">;</span> #listenters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span>checker<span class="token punctuation">,</span> data<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">&#39;object&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> obj<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&#39;styles,attributes,properties&#39;</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">        <span class="token keyword">this</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> ViewModel<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> ViewModel<span class="token punctuation">.</span><span class="token function">descriptor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">addListener</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> ViewModelListener<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#listenters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">removeListener</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> ViewModelListener<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#listenters<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">notify</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#listenters<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">.</span><span class="token function">viewmodelUpdated</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#isUpadated<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">viewmodelUpdated</span> <span class="token punctuation">(</span><span class="token parameter">updated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> updated<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#isUpdated<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>이 코드의 핵심은 <strong>descriptor에 정의한 setter를 통해서 값을 대체 한 다음 isUpdated에 변경된 내역을 추가하는 것이다.</strong></p><h3 id="composite" tabindex="-1"><a class="header-anchor" href="#composite"><span>Composite</span></a></h3><p>Composite Pattern은 <strong>위임을 반복</strong>하여 취합한다 = <strong>동적위임</strong></p><p>이것을 ViewModel에 적용해야 한다.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> ViewModel <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> ViewModelListener <span class="token punctuation">{</span></span>
<span class="line highlighted">  <span class="token keyword">static</span> #subjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span></span>
<span class="line highlighted">  <span class="token keyword">static</span> #inited <span class="token operator">=</span> <span class="token boolean">false</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">ViewModel</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">static</span> descriptor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token comment">/* 생략 */</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">static</span> defineProperties <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token comment">/* 생략 */</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token function">notify</span> <span class="token punctuation">(</span><span class="token parameter">vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 변화를 감지하고 Observer(Binder)에게 알린다.</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>#subjects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#inited<span class="token punctuation">)</span> <span class="token keyword">return</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>#inited <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">      <span class="token keyword">this</span><span class="token punctuation">.</span>#subjects<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">vm</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 만들어진 ViewModel에 대해 반복문을 돌린다.</span></span>
<span class="line highlighted">        <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>#isUpdated<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 변경된 내역이 있을 경우</span></span>
<span class="line highlighted">          vm<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Listener에게 알리고</span></span>
<span class="line highlighted">          vm<span class="token punctuation">.</span>#isUpdated<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 변경된 내역을 삭제한다.</span></span>
<span class="line highlighted">        <span class="token punctuation">}</span></span>
<span class="line highlighted">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  #isUpadated <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">;</span> #listenters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">;</span></span>
<span class="line">  styles<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> attributes<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> properties<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> events<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line highlighted">  subKey <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span> parent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span>checker<span class="token punctuation">,</span> data<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">&#39;object&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> obj<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&#39;styles,attributes,properties&#39;</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> ViewModel<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> ViewModel<span class="token punctuation">.</span><span class="token function">descriptor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line highlighted">        <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token keyword">instanceof</span> <span class="token class-name">ViewModel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">          v<span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">this</span> <span class="token comment">// 역 참조할 수 있어야 한다. </span></span>
<span class="line highlighted">          v<span class="token punctuation">.</span>subKey <span class="token operator">=</span> k</span>
<span class="line highlighted">          v<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// 자식이 변화했을 때 변화를 알아차린다.</span></span>
<span class="line highlighted">                              <span class="token comment">// ViewModel 은 Subject이자 Listener 인 경우가 빈번하다.</span></span>
<span class="line highlighted">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line highlighted">    ViewModel<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// ViewModel이 생성되는 시점에 변화의 감지를 시작한다.</span></span>
<span class="line highlighted">    Object<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// key가 추가/수정/삭제 되지 않도록 한다.</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">addListener</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> ViewModelListener<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#listenters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">removeListener</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> ViewModelListener<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#listenters<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line highlighted">  <span class="token function">notify</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#listenters<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">.</span><span class="token function">viewmodelUpdated</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#isUpadated<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line highlighted">  <span class="token function">viewmodelUpdated</span> <span class="token punctuation">(</span><span class="token parameter">updated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> updated<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#isUpdated<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// subKey가 생겼기 때문에 ViewModelValue 또한 변경해야한다. </span></span>
<span class="line"><span class="token keyword">const</span> ViewModelValue <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span></span>
<span class="line">  subKey<span class="token punctuation">;</span> category<span class="token punctuation">;</span> k<span class="token punctuation">;</span> v<span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">subKey<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> subKey<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>이 코드의 핵심 적인 내용은 <u>최상위의 ViewModel에서 모든 ViewModel의 변경내역을 취합하여 Binder에게 알리는 것</u> 이다.</p><h3 id="observer" tabindex="-1"><a class="header-anchor" href="#observer"><span>Observer</span></a></h3><p>이제 Observer 역할을 하는 Binder의 입장을 살펴봐야 한다. Binder는 ViewModel이 보내는 <strong>notify를 감지</strong>하여 <em>ViewModel의 값을 View에 Rendering</em> 한다.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> Binder <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> ViewModelListener <span class="token punctuation">{</span></span>
<span class="line">  #items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">;</span> #processors <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> BinderItem<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#items<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">addProcessor</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> Processor<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*생략*/</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter">viewmodel<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>viewmodel<span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">/*생략*/</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">watch</span> <span class="token punctuation">(</span><span class="token parameter">viewmodel<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>viewmodel<span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">    viewmodel<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span></span>
<span class="line highlighted">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>viewmodel<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">unwatch</span> <span class="token punctuation">(</span><span class="token parameter">viewmodel<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>viewmodel<span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    viewmodel<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line highlighted">  <span class="token function">viewmodelUpdated</span> <span class="token punctuation">(</span><span class="token parameter">updated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">    <span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line highlighted">    <span class="token keyword">this</span><span class="token punctuation">.</span>#items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> vmName<span class="token punctuation">,</span> el <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">      items<span class="token punctuation">[</span>vmName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">type</span><span class="token punctuation">(</span>rootViewModel<span class="token punctuation">[</span>vmName<span class="token punctuation">]</span><span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span><span class="token punctuation">,</span> el<span class="token punctuation">]</span></span>
<span class="line highlighted">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line highlighted">    updated<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> subKey<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line highlighted">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>items<span class="token punctuation">[</span>subKey<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span></span>
<span class="line highlighted">      <span class="token keyword">const</span> <span class="token punctuation">[</span>vm<span class="token punctuation">,</span> el<span class="token punctuation">]</span> <span class="token operator">=</span> items<span class="token punctuation">[</span>subKey<span class="token punctuation">]</span><span class="token punctuation">,</span> processor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#processors<span class="token punctuation">[</span>category<span class="token punctuation">]</span></span>
<span class="line highlighted">      <span class="token comment">// injection 이 안 되어 있을 경우  return</span></span>
<span class="line highlighted">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el <span class="token operator">||</span> <span class="token operator">!</span>processor<span class="token punctuation">)</span> <span class="token keyword">return</span></span>
<span class="line highlighted">      processor<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line highlighted">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line highlighted">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="https://www.plantuml.com/plantuml/svg/VP7D2i8m48JlUOezQg47Vqv5fEXP1K4znsQr2scsj6l5jpVHAhQYjp3pxMGsIMlHbLmAgpAs5ZCXTZKiSx9cJtXTiK4BN1ciOAHAZr96fNO2MsRf4-CEiI0NnASrwLXXi3McgfiqY-FNP0AROurLWuE3bYmVAiU2m8stUWKJk9H62vf_o9g5JZVLq-DutjibWQMs5gAeyL8HfDqpF8e-uhzck2Yv9i4_JDkWAuS2xuL_tzmYWNwyNW9R30gviqhzoN_X7G00" alt="uml diagram"><ul><li>Binder가 RootViewModel을 Observe 한다.</li><li>ChildViewModel이 Upated되면 Update된 내용을 취합하여 RootViewModel에게 보낸다.</li><li>RootViewModel은 취합된 내용을 Binder에게 알린다.</li></ul><p>이 설계에서 핵심이 되는 내용은, <u>Binder는 RootViewModel만 Observe 하고 있다는 것이다.</u></p><h2 id="client" tabindex="-1"><a class="header-anchor" href="#client"><span>Client</span></a></h2><p>위에서 작성한 코드를 직접 사용해보자.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token comment">// HTML에 정의된 viewmodel을 scan한다.</span></span>
<span class="line"><span class="token keyword">const</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">const</span> binder <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#target&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Binder에 Strategy를 주입한다.</span></span>
<span class="line">binder<span class="token punctuation">.</span><span class="token function">addProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token keyword">class</span> <span class="token class-name">extends</span> Processor <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">_process</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> el<span class="token punctuation">.</span>style<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&#39;styles&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">binder<span class="token punctuation">.</span><span class="token function">addProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token keyword">class</span> <span class="token class-name">extends</span> Processor <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">_process</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&#39;attributes&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">binder<span class="token punctuation">.</span><span class="token function">addProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token keyword">class</span> <span class="token class-name">extends</span> Processor <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">_process</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> el<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&#39;properties&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">binder<span class="token punctuation">.</span><span class="token function">addProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token keyword">class</span> <span class="token class-name">extends</span> Processor <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">_process</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> el<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">on</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>k<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">v</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> e<span class="token punctuation">,</span> vm<span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&#39;events&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ViewModel을 만든다.</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">getRandom</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">150</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">100</span></span>
<span class="line"><span class="token keyword">const</span> rootViewModel <span class="token operator">=</span> ViewModel<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">isStop</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">changeContents</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ViewModel이 변경되면, 이를 취합하여 RootViewModel에게 보낸다.</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>wrapper<span class="token punctuation">.</span>styles<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rgb(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>contents<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">wrapper</span><span class="token operator">:</span> ViewModel<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">styles</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">&#39;50%&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token string">&#39;#ffa&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">cursor</span><span class="token operator">:</span> <span class="token string">&#39;pointer&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">events</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">click</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        vm<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>isStop <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// rootViewModel.isStop = true 로 해도 된다. </span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">title</span><span class="token operator">:</span> ViewModel<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">innerHTML</span><span class="token operator">:</span> <span class="token string">&#39;Title&#39;</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">contents</span><span class="token operator">:</span> ViewModel<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">innerHTML</span><span class="token operator">:</span> <span class="token string">&#39;Contents&#39;</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Binder는 RootViewModel만 Observing 한다.</span></span>
<span class="line">binder<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>rootViewModel<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 테스트를 위하여 viewmodel의 내용을 실시간으로 변경하도록 한다.</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  viewmodel<span class="token punctuation">.</span><span class="token function">chagneContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>viewmodel<span class="token punctuation">.</span>isStop<span class="token punctuation">)</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="전체-코드" tabindex="-1"><a class="header-anchor" href="#전체-코드"><span>전체 코드</span></a></h3><p>&lt;&lt;&lt; @/CodeSpitz/Object-Oriented-Javascript/03-Strategy-Observer/example.html</p><p><a href="https://github.com/JunilHwang/TIL/blob/master/CodeSpitz/Object-Oriented-Javascript/03-Strategy-Observer/example.html" target="_blank" rel="noopener noreferrer">github에서 보기<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><ul><li><p>Strategy Pattern</p><ul><li>Binder의 Strategy를 찾아낸 후 추출한다.</li><li>Binder에 사용되는 각각의 Strategy를 만들어서 주입한다. (Dependency Injection)</li><li>이 때 Strategy는 TypeCheck를 하고, 구현은 ChildStrategy에게 맡긴다 (Template Method Pattern)</li></ul></li><li><p>Observer Pattern</p><ul><li>ViewModel의 변경 내역을 알리는 ViewModelListener Interface를 만들고, ViewModel과 Binder가 이를 상속하여 구현하도록 한다.</li><li>ChildViewModel에 변경이 일어나면 이를 취합하여 RootViewModel에게 알린다 (Composite Pattern)</li><li>RootViewModel은 취합한 내용을 Binder에게 알린다 (Notify)</li><li>Binder는 RootViewModel만 Observing 한다.</li></ul></li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><!----><!--[--><!--[--><div></div><!----><!--]--><!--]--></main><!--]--></div><footer class="siteFooter"><div class="container"><p class="siteFooterCopyright"> Copyright © 2019 All Right <em>개발자 황준일</em></p><p class="siteFooterContact"> junil.h@kakao.com . +82-10-5764-4483 . <a href="https://github.com/junilhwang" target="_blank">GitHub</a> . <a href="http://junil-hwang.com" target="_blank">Blog</a> . <a href="https://github.com/junilhwang/TIL/" target="_blank">Repository</a></p></div></footer><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/TIL/assets/app-5lrBuCb5.js" defer></script>
  </body>
</html>
