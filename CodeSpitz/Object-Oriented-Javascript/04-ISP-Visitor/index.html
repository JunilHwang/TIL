<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MVVM System 개선하기 (2) | 개발자 황준일</title>
    <meta name="description" content="ISP 원칙, Visitor Pattern 등을 적용하여 MVVM System을 더욱 개선합니다.">
    <link rel="alternate" type="application/rss+xml" href="https://junilhwang.github.io/TIL/rss.xml" title="개발자 황준일 RSS Feed">
  <link rel="alternate" type="application/atom+xml" href="https://junilhwang.github.io/TIL/feed.atom" title="개발자 황준일 Atom Feed">
  <link rel="alternate" type="application/json" href="https://junilhwang.github.io/TIL/feed.json" title="개발자 황준일 JSON Feed">
    
    <link rel="preload" href="/TIL/assets/css/0.styles.f62d19cd.css" as="style"><link rel="preload" href="/TIL/assets/js/app.a7579dad.js" as="script"><link rel="preload" href="/TIL/assets/js/3.34eb2dec.js" as="script"><link rel="preload" href="/TIL/assets/js/16.05451e9e.js" as="script"><link rel="preload" href="/TIL/assets/js/2.429b4dd1.js" as="script"><link rel="prefetch" href="/TIL/assets/js/10.34f19c96.js"><link rel="prefetch" href="/TIL/assets/js/11.e447e846.js"><link rel="prefetch" href="/TIL/assets/js/12.e9c7d82e.js"><link rel="prefetch" href="/TIL/assets/js/13.a3ba3446.js"><link rel="prefetch" href="/TIL/assets/js/14.3c8aca02.js"><link rel="prefetch" href="/TIL/assets/js/15.2b79eb09.js"><link rel="prefetch" href="/TIL/assets/js/17.8aedc6dc.js"><link rel="prefetch" href="/TIL/assets/js/18.c7624f6b.js"><link rel="prefetch" href="/TIL/assets/js/19.be17f515.js"><link rel="prefetch" href="/TIL/assets/js/20.57baa374.js"><link rel="prefetch" href="/TIL/assets/js/21.17d933bb.js"><link rel="prefetch" href="/TIL/assets/js/4.afcbbd6a.js"><link rel="prefetch" href="/TIL/assets/js/5.0962dbec.js"><link rel="prefetch" href="/TIL/assets/js/6.aaba8ef8.js"><link rel="prefetch" href="/TIL/assets/js/7.6aeead53.js"><link rel="prefetch" href="/TIL/assets/js/8.1df91011.js"><link rel="prefetch" href="/TIL/assets/js/9.044ee736.js">
    <link rel="stylesheet" href="/TIL/assets/css/0.styles.f62d19cd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><main class="page"> <div class="theme-default-content content__default"><h1 id="mvvm-system-개선하기-2"><a href="#mvvm-system-개선하기-2" class="header-anchor">#</a> MVVM System 개선하기 (2)</h1> <div class="custom-block tip"><p class="custom-block-title">해당 포스트는 아래의 내용들을 토대로 정리한 것입니다.</p> <p><a href="https://www.youtube.com/watch?v=r4vOF7WpxgM&amp;t=868s" target="_blank" rel="noopener noreferrer">코드스피츠 86기 4회차 동영상<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <p>객체지향 프로그램이란 처음에 이루고하자는 목표에서부터 <u>덩어리진 것을 차근차근 분리하고 깎아내는 과정</u> 이다.
그래서 객체지향 개발은 애자일(Agile) 소프트웨어 개발과 궁합이 좋다.</p> <p>객체지향에서 코드를 깎아내는 기준은 <u>역할과 책임</u> 이다.
역할과 책임은 비슷하지만 동전의 양면과 같다.</p> <div class="custom-block tip"><p class="custom-block-title">역할과 책임</p> <ul><li>책임을 진다는 것은 책임에 적합한 권한도 갖고 있다는 것이다.</li> <li>권한이 있다는 것은 권한에 적합한 책임도 갖고 있다는 것이다.</li> <li>책임이 없는데 권한이 없거나 권한이 없는데 책임이 있다면 문제가 생긴다.</li></ul></div> <p>인간의 머리는 복잡성의 한계가 있다.
그래서 객체지향을 통하여 좋은 코드를 만드는 방법은 코드를 잘 쪼개서 인간이 인식할 수 있는 복잡성 만큼 수용하는 것이다.
그런데 쪼개는 것이 어렵기 때문에 일관성 있게 쪼개는 방법이 중요하다.
그래서 <u>역할과 책임에 맡게 코드를 쪼개는 연습을 해야 한다.</u></p> <p>이번에는 역할과 책임에 따라 코드를 쪼개고 깎아내는 과정을 살펴볼 것이다.</p> <h2 id="인터페이스-분리-원칙-isp"><a href="#인터페이스-분리-원칙-isp" class="header-anchor">#</a> 인터페이스 분리 원칙 (ISP)</h2> <p>먼저 ViewModel에 <u>인터페이스 분리 원칙(ISP, Interface Segregation Principle)</u> 을 적용해야 한다.</p> <h3 id="역할과-책임에-따른-분석"><a href="#역할과-책임에-따른-분석" class="header-anchor">#</a> 역할과 책임에 따른 분석</h3> <p>여태까지 만든 ViewModel은 매우 heavy 한 상태다.</p> <img src="https://www.plantuml.com/plantuml/svg/NOyx3i8m44HxdsAL2aeuGGu09VJ6Euai-QVr9YX2t1rJ6AHqe_T66irOrOekCHY1Kvlc0BfxFA-P4UXbY9mLfY5bzTDsQ6trxZYGhPHEUrkMH_ZPSxUM-UAh8a4w4iIyOa_NjXk_kxV2Li6Tpz0U6TM9BvhbJoQVODvcHEBsumC0" alt="uml diagram"> <div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> ViewModel <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> ViewModelListener <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">ViewModel</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token keyword">static</span> #subjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span>
  <span class="token keyword">static</span> #inited <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">static</span> <span class="token function">notify</span> <span class="token punctuation">(</span><span class="token parameter">vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#subjects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#inited<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#inited <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">const</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>#subjects<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">vm</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>#isUpdated<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          vm<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          vm<span class="token punctuation">.</span>#isUpdated<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token function-variable function">descriptor</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">,</span>
    <span class="token keyword">set</span> <span class="token punctuation">(</span>newV<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      v <span class="token operator">=</span> newV
      vm<span class="token punctuation">.</span>#isUpdated<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ViewModelValue</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>subKey<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">static</span> <span class="token function-variable function">define</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> category<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span>
      obj<span class="token punctuation">,</span>
      Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r<span class="token punctuation">,</span> <span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>r<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> ViewModel<span class="token punctuation">.</span><span class="token function">descriptor</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>

  subKey <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> parent <span class="token operator">=</span> <span class="token keyword">null</span>
  styles <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> attributes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> properties <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> events <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  #isUpdated <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">;</span> #listeners <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'styles,attributes,properties'</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>v <span class="token operator">||</span> <span class="token keyword">typeof</span> v <span class="token operator">!=</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">invalid object k: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>k<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, v:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>v<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
        <span class="token keyword">this</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> ViewModel<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> ViewModel<span class="token punctuation">.</span><span class="token function">descriptor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token keyword">instanceof</span> <span class="token class-name">ViewModel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          v<span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">this</span>
          v<span class="token punctuation">.</span>subKey <span class="token operator">=</span> k
          v<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    ViewModel<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    Object<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">viewmodelUpdated</span> <span class="token punctuation">(</span><span class="token parameter">updated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> updated<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#isUpdated<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token function">addListener</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> ViewModelListener<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#listeners<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token function">removeListener</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> ViewModelListener<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#listeners<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token function">notify</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#listeners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">.</span><span class="token function">viewmodelUpdated</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#isUpdated<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>그런데 과연 이 코드가 정말로 ViewModel에게 전부 필요한 것일까?</p> <p>ViewModel의 원래 역할은 물리적인 View(DOM, Android, IOS, ..)를 대신하여 <u>순수한 메모리 객체로서의 View(가상의 View)</u> 를 만들어내는 것이다.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">static</span> #subjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span>
<span class="token keyword">static</span> #inited <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">static</span> <span class="token function">notify</span> <span class="token punctuation">(</span><span class="token parameter">vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>#subjects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#inited<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>#inited <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token keyword">const</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#subjects<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">vm</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>#isUpdated<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        vm<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        vm<span class="token punctuation">.</span>#isUpdated<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

#isUpdated <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">;</span> #listeners <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span> <span class="token comment">// 메소드가 의존하고 있는 field</span>
<span class="token function">addListener</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> ViewModelListener<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#listeners<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token function">removeListener</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> ViewModelListener<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#listeners<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token function">notify</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#listeners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">.</span><span class="token function">viewmodelUpdated</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#isUpdated<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
</code></pre></div><p>위의 Method와 Field는 ViewModel의 역할에 적합하지 않다.
이것은 <u>Observer Pattern에서 Subject의 역할</u> 에 해당하는 부분이다.
그래서 이 Method와 이것에 의존하고 있는 field를 <strong>역할에 따라 분리</strong>시켜야 한다.</p> <h3 id="isp-적용하기"><a href="#isp-적용하기" class="header-anchor">#</a> ISP 적용하기</h3> <p>기존의 ViewModel을 다음과 같은 형태로 변경할 것이다.</p> <img src="https://www.plantuml.com/plantuml/svg/RPB1Ri8m38RlVGeBBkp00Pw01s2dQRiW3YPs8LFgLgaBGeXt9qrXILUa7fBlintvLpUjejUkSeLdeoX7n_1Z-V9P4pku5G1l-5Tt-0qqQW23dc0cjThokcYwWxFcOmROWgocFZodVtwTF19jRQiix1FqNDLddl9G3FCIoqICO_J_s0NLd62EEUjaHE_lztkzc2zu3hBgvNT3g4pFxkYEhAyZSMkyRRJsYPHMEDp25mfXkToTB17BFgdXC5RP75b1CZ4rMMTad5rsosecKVOpHoE6rgmbPjfl4RDDF2OO-91auiziYtknOQ7mIpq0" alt="uml diagram"> <p>보다시피 <code>add</code>와 <code>clear</code>가 추가되었다. add와 clear를 통해서 부모(ViewModel)에게 역할을 위임하도록 만들 것이다.</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token comment">// Javascript는 다중 상속이 불가능하기 때문에</span>
<span class="token comment">// ViewModelSubject가 ViewModelListener를 상속받아야 한다.</span>
<span class="token keyword">const</span> ViewModelSubject <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> ViewModelListener <span class="token punctuation">{</span>

  #info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span>
  #listeners <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span>

  <span class="token comment">// add와 clear를 통해 부모에게 역할을 위임한다.</span>
  <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> ViewModelValue<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#info<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token function">clear</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#info<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token function">addListener</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> ViewModelListener<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#listeners<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    ViewModelSubject<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">removeListener</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> ViewModelListener<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#listeners<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>#listeners<span class="token punctuation">.</span>size<span class="token punctuation">)</span> ViewModelSubject<span class="token punctuation">.</span><span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">notify</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#listeners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">.</span><span class="token function">viewmodelUpdated</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#info<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>아직 코드상에 작성하진 않았지만 <em>addListener</em>에는 <code>ViewModelSubject.watch</code>가 생겼고,
<em>removeListener</em>에는 <code>ViewModelSubject.unwatch</code>가 생겼다.</p> <p>기존에는 <code>notify</code>를 통해서 데이터를 노출 시켰는데 <u>논리적으로 생각했을 때 외부에서 명시적으로 알아야 하는 것은 <code>watch</code>와 <code>unwatch</code></u> 이다.
그래서 watch와 unwatch를 노출시키고, notify는 감추도록 만들어야 한다.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>notify mechanism은 감추고, watch와 unwatch를 인터페이스로 공개한다.</p></div> <p>이제 <code>notify</code>를 살펴봐야 한다.</p> <div class="language-js extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">static</span> <span class="token function">notify</span> <span class="token punctuation">(</span><span class="token parameter">vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>#subjects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#inited<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>#inited <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token keyword">const</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#subjects<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">vm</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>#isUpdated<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        vm<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        vm<span class="token punctuation">.</span>#isUpdated<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>notify method 내부에 <code>this.#subject.add</code>가 있다.
그 의미는 notify가 두 가지의 역할을 수행하고 있다는 것이고, 이런 코드를 유지하게 될 경우 문제가 생길 수 있다.
각각의 메소드는 가능한한 한 가지의 역할만 수행하게 하여 <u>단일책임원칙(SCP, Single Responsibility Principle)이 지켜지도록</u> 해야한다</p> <div class="language-js extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code>  <span class="token keyword">static</span> #subjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span>
  <span class="token keyword">static</span> #inited <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">static</span> <span class="token function">notify</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>#subjects<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>#info<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          v<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          v<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#inited<span class="token punctuation">)</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token function">watch</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> ViewModelListener<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#subjects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>#inited<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>#inited <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token function">unwatch</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> ViewModelListener<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#subjects<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>#subjects<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#inited <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>위에도 언급 했듯이 notify mechanism은 감추고 watch와 unwatch를 통해 interface로 제공해야 한다.
그리고 notify는 하나의 역할만 수행하도록 하여 책임을 분산시킨다.</p> <h2 id="섬세한-권한-조정"><a href="#섬세한-권한-조정" class="header-anchor">#</a> 섬세한 권한 조정</h2> <div class="custom-block tip"><p class="custom-block-title">권한 조정이 필요한 이유</p> <p>java의 기본 권한은 private 이고, javascript의 기본 권한은 public이다.</p> <p>그래서 javascript는 개발자가 하나하나 권한을 조정하지 않으면 기본적으로 public이 되서 엉망이 된다.
getter, setter 등이 public 으로 노출되면 코드 조작이 매우 쉬워지고 문제가 생길 수 있다.</p></div> <div class="custom-block tip"><p class="custom-block-title">transaction</p> <p>transaction이 발견 되면 무조건 function으로 표현해야 한다. transaction이 코드에 섞여있을 경우 문제가 발생할 확률이 높다(응용 하기가 쉽지 않다).</p></div> <div class="language-js extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> ViewModel <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> ViewModelSubject <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ViewModel</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">}</span>
  styles <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> attributes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> properties <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> events <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  #subKey <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token keyword">get</span> <span class="token function">subKey</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#subKey <span class="token punctuation">}</span> <span class="token comment">// read only</span>
  #parent <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">get</span> <span class="token function">parent</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#parent <span class="token punctuation">}</span>
  
  <span class="token comment">// code에서  꼭 필요한 것 : transaction.</span>
  <span class="token function">setParent</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> subKey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 함수를 통해서 transaction을 표현한다(한 번에 일어나는 일들)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#parent <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#subKey <span class="token operator">=</span> subKey
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token function-variable function">descriptor</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">,</span>
    <span class="token keyword">set</span> <span class="token punctuation">(</span>newV<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      v <span class="token operator">=</span> newV
      vm<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ViewModelValue</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>subKey<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">static</span> <span class="token function-variable function">define</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> category<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span>
      obj<span class="token punctuation">,</span>
      Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r<span class="token punctuation">,</span> <span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>r<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> ViewModel<span class="token punctuation">.</span><span class="token function">descriptor</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'styles,attributes,properties'</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>v <span class="token operator">||</span> <span class="token keyword">typeof</span> v <span class="token operator">!=</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">invalid object k: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>k<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, v:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>v<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
        <span class="token keyword">this</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> ViewModel<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> ViewModel<span class="token punctuation">.</span><span class="token function">descriptor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token keyword">instanceof</span> <span class="token class-name">ViewModel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
          <span class="token comment">// transaction을 method로 분리했다.</span>
          v<span class="token punctuation">.</span><span class="token function">setParent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    Object<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">viewmodelUpdated</span> <span class="token punctuation">(</span><span class="token parameter">updated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> updated<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ViewModel에서 개선된 내용은 다음과 같다.</p> <ul><li><u>권한 조정</u> : subKey, parent에 대한 getter와 setter를 만들었다.</li> <li><u>역할/책임에 따른 인터페이스 분할(ISP)</u>  : ViewModel은 ViewModelSubject를 상속하도록 변경했다.</li> <li><u>tranaction 도출</u> : parent에 대한 transaction 단위를 분리했다.</li></ul> <h2 id="visitor-pattern"><a href="#visitor-pattern" class="header-anchor">#</a> Visitor Pattern</h2> <p><code>Visitor Pattern</code>은 객체의 구조와 기능을 분리시키는 패턴이다. 이것을 이용하여 DOM에 관련된 기능을 MVVM과 분리시키는 작업을 할 것이다.</p> <p>먼저 Scanner를 살펴보자.</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> Scanner <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
  <span class="token function">scan</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> HTMLElement<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> binder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Binder</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkTiem</span><span class="token punctuation">(</span>binder<span class="token punctuation">,</span> el<span class="token punctuation">)</span>
    <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span>el<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">]</span>
    <span class="token keyword">let</span> target
    <span class="token keyword">while</span> <span class="token punctuation">(</span>target <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkItem</span><span class="token punctuation">(</span>binder<span class="token punctuation">,</span> target<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">)</span> stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">)</span> stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> binder<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">checkItem</span> <span class="token punctuation">(</span><span class="token parameter">binder<span class="token punctuation">,</span> el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> vm <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-viewmodel'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">)</span> binder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BinderItem</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Scanner의 핵심은 <u>ViewModel을 읽어들여서 Binder에 전달</u> 하는 것이다. 그리고 checkItem이 그러한 역할을 담당하고 있다.</p> <p>여기서 문제되는 부분은 <code>scan method</code> 이다.</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code>  <span class="token function">scan</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> HTMLElement<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> binder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Binder</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkTiem</span><span class="token punctuation">(</span>binder<span class="token punctuation">,</span> el<span class="token punctuation">)</span>
    <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span>el<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">]</span>
    <span class="token keyword">let</span> target
    <span class="token keyword">while</span> <span class="token punctuation">(</span>target <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkItem</span><span class="token punctuation">(</span>binder<span class="token punctuation">,</span> target<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">)</span> stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">)</span> stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> binder<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>DOM을 읽어 들이는 부분은 scanner의 역할이 아니고 Binder의 역할도 아니다.
그래서 Vistor를 만든 후 Vistor에게 DOM Parsing에 대한 부분을 위임해야 한다.
이럴 경우 Binder, Scanner, ViewModel 등은 DOM과 분리되고 결과적으로 현재 작성 중인 MVVM System은 <u>플랫폼(웹, 안드로이드, IOS, ...)에 대한 종속이 느슨해지게 될 것이다.</u></p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token comment">// Visitor : 제어를 Visitor에게 위임한다.</span>
<span class="token keyword">const</span> Visitor <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
  <span class="token comment">// target의 경우 HTML인지 Canvas인지 알 수 없다. 그래서 추상화 시켜야 한다.</span>
  <span class="token function">visit</span> <span class="token punctuation">(</span>action<span class="token punctuation">,</span> target<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token string">'override'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> DomVisitor <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Visitor <span class="token punctuation">{</span>
  <span class="token comment">// 자식에서 구체적인 형을 알게 되는 것 : Generic</span>
  <span class="token comment">// 언어가 어떤 기능을 지원 하느냐보단 그 개념을 어떻게 적용하느냐가 중요하다.</span>
  <span class="token function">visit</span> <span class="token punctuation">(</span>action<span class="token punctuation">,</span> target <span class="token punctuation">,</span> _0 <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> _1 <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> HTMLElement<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 제어의 코드가 Visitor에게 몰리기 때문에 제어 역전이 발생한다.</span>
    <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> curr <span class="token operator">=</span> target<span class="token punctuation">.</span>firstElementChild
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
      <span class="token comment">// loop 안에서 상호작용을 해야 한다.</span>
      <span class="token function">action</span><span class="token punctuation">(</span>curr<span class="token punctuation">)</span> <span class="token comment">// template method의 hook가 비슷한 역할</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>curr<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">)</span> stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>curr<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>curr<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">)</span> stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>curr<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>curr <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Visitor를 작성했으니, Scanner의 코드를 다시 작성해야 한다.</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> Scanner <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
  #visitor
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">visitor<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>visitor<span class="token punctuation">,</span> DomVisitor<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#visitor <span class="token operator">=</span> visitor
  <span class="token punctuation">}</span>
  <span class="token function">scan</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> _ <span class="token operator">=</span> type9target<span class="token punctuation">,</span> HTMLElement</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> binder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Binder</span>
    <span class="token comment">// Scanner는 ViewModel을 읽어들이기만 하면 된다.</span>
    <span class="token keyword">const</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token parameter">el</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> vm <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-viewmodel'</span><span class="token punctuation">)</span> <span class="token comment">// 코드의 변화 요인은 이 부분 밖에 없다</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">)</span> binder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BinderItem</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">f</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token comment">// DomScan은 Visitor에게 위임한다</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#visitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> target<span class="token punctuation">)</span>
    <span class="token keyword">return</span> binder
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">설계라는 것</p> <p>설계는 객체의 재배치가 아닌 코드의 재배치이다. 객체에 작성된 코드가 정말로 이 객체의 것인지 판단할 수 있는 능력이 중요하다.</p></div> <h2 id="추상-계층-일치시키기"><a href="#추상-계층-일치시키기" class="header-anchor">#</a> 추상 계층 일치시키기</h2> <p>의존성은 계층 관계를 보고 설정해야 한다.</p> <ul><li>객체 간의 계약 = 의존성</li> <li>어떤 객체를 알고 있다 = 어떤 객체의 <em>스펙</em>을 알고 있다.</li> <li><u>니가(Scanner) 망한다 = 나도(Binder) 망한다</u></li></ul> <p>현재 Scanner와 Binder의 경우 <u>추상 계층이 일치 하지 않는 상태다.</u></p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> Scanner <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
  #visitor
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">visitor<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>visitor<span class="token punctuation">,</span> DomVisitor<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#visitor <span class="token operator">=</span> visitor <span class="token comment">// 자식 계층(DomVisitor)을 사용하고 있다.</span>
  <span class="token punctuation">}</span>
  <span class="token function">scan</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> _ <span class="token operator">=</span> type9target<span class="token punctuation">,</span> HTMLElement</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> binder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Binder</span>
    <span class="token keyword">const</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token parameter">el</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> vm <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-viewmodel'</span><span class="token punctuation">)</span> 
      <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">)</span> binder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BinderItem</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">f</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#visitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> target<span class="token punctuation">)</span> <span class="token comment">// 부모 계층(Visitor)을 사용하고 있다.</span>
    <span class="token keyword">return</span> binder
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Visitor는 계층이 두 개(Visitor, DomVisitor)고, Scanner는 계층이 한 개이기 때문이다.</p> <img src="https://www.plantuml.com/plantuml/svg/SoWkIImgAStDuIfAJIv9p4lFILK8JaxCoqijGX9noSyDoopEBCb75eI9G9KhwDh1XQ2qWeskBf9U1Iw7rBmKe5q0" alt="uml diagram"> <p>그래서 추상 계층은 서로 일치를 시켜줘야 한다.</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> Scanner <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
  #visitor
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">visitor<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>visitor<span class="token punctuation">,</span> Visitor<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#visitor <span class="token operator">=</span> visitor
  <span class="token punctuation">}</span>
  <span class="token function">visit</span> <span class="token punctuation">(</span><span class="token parameter">f<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#visitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> target<span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token function">scan</span> <span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">override</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> DomScanner <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Scanner <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">visitor<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>visitor<span class="token punctuation">,</span> DomVisitor<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>visitor<span class="token punctuation">)</span> <span class="token comment">// 자식은 부모를 대체할 수 있다. LSP</span>
  <span class="token punctuation">}</span>
  <span class="token function">scan</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> HTMLElement<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> binder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Binder</span>
    <span class="token keyword">const</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token parameter">el</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> vm <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-viewmodel'</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">)</span> binder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BinderItem</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">f</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> target<span class="token punctuation">)</span>
    <span class="token keyword">return</span> binder
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><img src="https://www.plantuml.com/plantuml/svg/SoWkIImgAStDuIfAJIv9p4lFILLmoSyDJaxCoqijGXB4504g2yiipYp9HnQ4YK2LA-ZQmOMWj8ADhYwINWMuKgWup2A7rBmKeBi0" alt="uml diagram"> <div class="custom-block tip"><p class="custom-block-title">도메인 패턴</p> <p><u>변하지 않는 부분과 변하는 부분을 나눠야 한다.</u></p> <p>추상 클래스(Scanner, Visitor)는 Native를 모르는 상태로 유지하고,
Native는 구현 클래스(DomScanner, DomVisitor)에게 위임한다.</p> <p><em>Reference <a href="https://wikibook.co.kr/peaa/" target="_blank" rel="noopener noreferrer">엔터프라이즈 애플리케이션 아키텍처 패턴<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></em></p></div> <ul><li>추상 레이어를 나누면 좋은점
<ul><li>새로운 변화가 생기거나 새로운 요구사항이 생겼을 때 수정이 아니라 추가로 해결한다.</li> <li>코드를 고치지 않고, 코드를 추가한다.</li> <li>수정하지 않고 확장한다.</li></ul></li> <li>단일책임원칙(OCP, Open Close Principle)을 지키기 위해서는 추상화가 필수다.</li></ul> <p><strong>SOLID 원칙은 사실 설계를 잘 했을 때 얻어지는 결과물이라고 할 수 있다.</strong></p> <h2 id="전체-코드"><a href="#전체-코드" class="header-anchor">#</a> 전체 코드</h2> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>MVVM<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>target<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-viewmodel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wrapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">data-viewmodel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">data-viewmodel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>contents<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

<span class="token keyword">const</span> <span class="token function-variable function">type</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> type <span class="token operator">==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> target <span class="token operator">!=</span> type<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">invalid type </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> : </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>target <span class="token keyword">instanceof</span> <span class="token class-name">type</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">invalid type </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> : </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> target<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> ViewModelListener <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
  <span class="token function">viewmodelUpdated</span><span class="token punctuation">(</span><span class="token parameter">updated</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">throw</span> <span class="token string">'override'</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> ViewModelSubject <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> ViewModelListener <span class="token punctuation">{</span>
  <span class="token keyword">static</span> #subjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span>
  <span class="token keyword">static</span> #inited <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">static</span> <span class="token function">notify</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>#subjects<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>#info<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          v<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          v<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#inited<span class="token punctuation">)</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token function">watch</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> ViewModelListener<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#subjects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>#inited<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>#inited <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token function">unwatch</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> ViewModelListener<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#subjects<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>#subjects<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#inited <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
  #info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span>
  #listeners <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span>
  <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> ViewModelValue<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#info<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token function">clear</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#info<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token function">addListener</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> ViewModelListener<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#listeners<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    ViewModelSubject<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">removeListener</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> ViewModelListener<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#listeners<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>#listeners<span class="token punctuation">.</span>size<span class="token punctuation">)</span> ViewModelSubject<span class="token punctuation">.</span><span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">notify</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#listeners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">.</span><span class="token function">viewmodelUpdated</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#info<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">const</span> ViewModel <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> ViewModelSubject <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ViewModel</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">}</span>
  styles <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> attributes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> properties <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> events <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  #subKey <span class="token operator">=</span> <span class="token string">''</span>
  #parent <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">get</span> <span class="token function">subKey</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#subKey <span class="token punctuation">}</span> <span class="token comment">// read only</span>
  <span class="token keyword">get</span> <span class="token function">parent</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#parent <span class="token punctuation">}</span>
  <span class="token function">setParent</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> subKey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#parent <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#subKey <span class="token operator">=</span> subKey
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token function-variable function">descriptor</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">,</span>
    <span class="token keyword">set</span> <span class="token punctuation">(</span>newV<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      v <span class="token operator">=</span> newV
      vm<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ViewModelValue</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>subKey<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">static</span> <span class="token function-variable function">define</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> category<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span>
      obj<span class="token punctuation">,</span>
      Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r<span class="token punctuation">,</span> <span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>r<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> ViewModel<span class="token punctuation">.</span><span class="token function">descriptor</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'styles,attributes,properties'</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>v <span class="token operator">||</span> <span class="token keyword">typeof</span> v <span class="token operator">!=</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">invalid object k: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>k<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, v:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>v<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
        <span class="token keyword">this</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> ViewModel<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> ViewModel<span class="token punctuation">.</span><span class="token function">descriptor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token keyword">instanceof</span> <span class="token class-name">ViewModel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          v<span class="token punctuation">.</span><span class="token function">setParent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    Object<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">viewmodelUpdated</span> <span class="token punctuation">(</span><span class="token parameter">updated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> updated<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> ViewModelValue <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
  subKey<span class="token punctuation">;</span> category<span class="token punctuation">;</span> k<span class="token punctuation">;</span> v<span class="token punctuation">;</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">subKey<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> subKey<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v <span class="token punctuation">}</span><span class="token punctuation">)</span>
    Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> BinderItem <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
  el<span class="token punctuation">;</span> vmName<span class="token punctuation">;</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span>el<span class="token punctuation">,</span> vmName<span class="token punctuation">,</span> _0 <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> HTMLElement<span class="token punctuation">)</span><span class="token punctuation">,</span> _1 <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>vmName<span class="token punctuation">,</span> <span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>el <span class="token operator">=</span> el
    <span class="token keyword">this</span><span class="token punctuation">.</span>vmName <span class="token operator">=</span> vmName
    Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Binder <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> ViewModelListener <span class="token punctuation">{</span>
  #items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">;</span>
  #processors <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> BinderItem<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#items<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token function">addProcessor</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> Processor<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#processors<span class="token punctuation">[</span>v<span class="token punctuation">.</span>category<span class="token punctuation">]</span> <span class="token operator">=</span> v <span class="token punctuation">}</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter">viewmodel<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>viewmodel<span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> processores <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#processors<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> vmName<span class="token punctuation">,</span> el <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>viewmodel<span class="token punctuation">[</span>vmName<span class="token punctuation">]</span><span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span>
      processores<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>pk<span class="token punctuation">,</span> processor<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>vm<span class="token punctuation">[</span>pk<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          processor<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">watch</span><span class="token punctuation">(</span><span class="token parameter">viewmodel<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>viewmodel<span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    viewmodel<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>viewmodel<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token parameter">viewmodel<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>viewmodel<span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    viewmodel<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">viewmodelUpdated</span> <span class="token punctuation">(</span><span class="token parameter">updated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> vmName<span class="token punctuation">,</span> el <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      items<span class="token punctuation">[</span>vmName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">type</span><span class="token punctuation">(</span>rootViewModel<span class="token punctuation">[</span>vmName<span class="token punctuation">]</span><span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span><span class="token punctuation">,</span> el<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    updated<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> subKey<span class="token punctuation">,</span> category<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>items<span class="token punctuation">[</span>subKey<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>vm<span class="token punctuation">,</span> el<span class="token punctuation">]</span> <span class="token operator">=</span> items<span class="token punctuation">[</span>subKey<span class="token punctuation">]</span><span class="token punctuation">,</span> processor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#processors<span class="token punctuation">[</span>category<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el <span class="token operator">||</span> <span class="token operator">!</span>processor<span class="token punctuation">)</span> <span class="token keyword">return</span>
      processor<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Processor <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
  category<span class="token punctuation">;</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">category</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>category <span class="token operator">=</span> category
    Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">process</span> <span class="token punctuation">(</span>vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">,</span> _0 <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> ViewModel<span class="token punctuation">)</span><span class="token punctuation">,</span>
                         _1 <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> HTMLElement<span class="token punctuation">)</span><span class="token punctuation">,</span>
                         _2 <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_process</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">_process</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token string">'override'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Scanner <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
  #visitor
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">visitor<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>visitor<span class="token punctuation">,</span> Visitor<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#visitor <span class="token operator">=</span> visitor
  <span class="token punctuation">}</span>
  <span class="token function">visit</span> <span class="token punctuation">(</span><span class="token parameter">f<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#visitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> target<span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token function">scan</span> <span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">override</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> DomScanner <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Scanner <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">visitor<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>visitor<span class="token punctuation">,</span> DomVisitor<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>visitor<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">scan</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> HTMLElement<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> binder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Binder</span>
    <span class="token keyword">const</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token parameter">el</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> vm <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-viewmodel'</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">)</span> binder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BinderItem</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">f</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> target<span class="token punctuation">)</span>
    <span class="token keyword">return</span> binder
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Visitor <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
  <span class="token function">visit</span> <span class="token punctuation">(</span>action<span class="token punctuation">,</span> target<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token string">'override'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> DomVisitor <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Visitor <span class="token punctuation">{</span>
  <span class="token function">visit</span> <span class="token punctuation">(</span>action<span class="token punctuation">,</span> target <span class="token punctuation">,</span> _0 <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> _1 <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> HTMLElement<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> curr <span class="token operator">=</span> target<span class="token punctuation">.</span>firstElementChild
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
      <span class="token function">action</span><span class="token punctuation">(</span>curr<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>curr<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">)</span> stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>curr<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>curr<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">)</span> stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>curr<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>curr <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DomScanner</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DomVisitor</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> binder <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#target'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
binder<span class="token punctuation">.</span><span class="token function">addProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">class</span> <span class="token keyword">extends</span> <span class="token class-name">Processor</span> <span class="token punctuation">{</span>
  <span class="token function">_process</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> el<span class="token punctuation">.</span>style<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token string">'styles'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
binder<span class="token punctuation">.</span><span class="token function">addProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">class</span> <span class="token keyword">extends</span> <span class="token class-name">Processor</span> <span class="token punctuation">{</span>
  <span class="token function">_process</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token string">'attributes'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
binder<span class="token punctuation">.</span><span class="token function">addProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">class</span> <span class="token keyword">extends</span> <span class="token class-name">Processor</span> <span class="token punctuation">{</span>
  <span class="token function">_process</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> el<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token string">'properties'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
binder<span class="token punctuation">.</span><span class="token function">addProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">class</span> <span class="token keyword">extends</span> <span class="token class-name">Processor</span> <span class="token punctuation">{</span>
  <span class="token function">_process</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> el<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">on</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>k<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">v</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> e<span class="token punctuation">,</span> vm<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">getRandom</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">150</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">100</span>
<span class="token keyword">const</span> wrapper <span class="token operator">=</span> ViewModel<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  styles<span class="token punctuation">:</span> <span class="token punctuation">{</span> width<span class="token punctuation">:</span> <span class="token string">'50%'</span><span class="token punctuation">,</span> background<span class="token punctuation">:</span> <span class="token string">'#ffa'</span><span class="token punctuation">,</span> cursor<span class="token punctuation">:</span> <span class="token string">'pointer'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  events<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">click</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>isStop <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> title <span class="token operator">=</span> ViewModel<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span> properties<span class="token punctuation">:</span> <span class="token punctuation">{</span> innerHTML<span class="token punctuation">:</span> <span class="token string">'Title'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> contents <span class="token operator">=</span> ViewModel<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span> properties<span class="token punctuation">:</span> <span class="token punctuation">{</span> innerHTML<span class="token punctuation">:</span> <span class="token string">'Contents'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> rootViewModel <span class="token operator">=</span> ViewModel<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  isStop<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token function">changeContents</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>wrapper<span class="token punctuation">.</span>styles<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rgb(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>contents<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  wrapper<span class="token punctuation">,</span> title<span class="token punctuation">,</span> contents
<span class="token punctuation">}</span><span class="token punctuation">)</span>
binder<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>rootViewModel<span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  rootViewModel<span class="token punctuation">.</span><span class="token function">changeContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rootViewModel<span class="token punctuation">.</span>isStop<span class="token punctuation">)</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre></div><p><a href="https://github.com/JunilHwang/TIL/blob/master/CodeSpitz/Object-Oriented-Javascript/04-ISP-Visitor/example.html" target="_blank" rel="noopener noreferrer">github에서 보기<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="설계-종합"><a href="#설계-종합" class="header-anchor">#</a> 설계 종합</h2> <h3 id="viewmodel"><a href="#viewmodel" class="header-anchor">#</a> ViewModel</h3> <p>ViewModelValue의 경우 의존하는 객체가 많기 때문에 수정에 대한 위험성이 굉장히 크다</p> <img src="https://www.plantuml.com/plantuml/svg/SoWkIImgAStDuKfEB4fH2CjCBVVDJqb5vmQN9cMb9fUWYVfa5fUavgKMeGc79UQKfd9nOIXJiD7LnJGING1L5JPZTEtGxS8m0qE9We825ve8gZqEgNafm6000000" alt="uml diagram"> <ul><li>단방향 의존성 지향
<ul><li>현재 상태의 장점은 <u>단 방향 의존성만 있다는 것</u> 이다.</li> <li>객체를 설계 할 때 순환 의존성이 생기지 않도록 항상 주의 해야 한다.</li></ul></li> <li>도메인 분리
<ul><li>ViewModel은 <u>DOM에 의존적이지 않다.</u></li> <li>다른 의미로 <u>플랫폼에 종속적이지 않다.</u></li></ul></li> <li>ViewModelValue에게 모여든다
<ul><li>화살표가 모인다는 것은, 무거운 객체라는 의미다</li> <li>무거운 객체는 수정의 여파가 매우 크다.</li> <li>즉, 쉽게 수정 하면 안 되는 객체다.</li></ul></li></ul> <h3 id="scanner"><a href="#scanner" class="header-anchor">#</a> Scanner</h3> <p>Scanner에는 Visitor를 사용 하여 DOM과 관련된 기능을 분리했다.</p> <img src="https://www.plantuml.com/plantuml/svg/SoWkIImgAStDuKfEB4fH24vEpCjBBO9mNF9pKVXXcSMP9Va8IHYV2wfAmKPN5raJJ5ZN3guLIiDKmeGTKlDIW6u00000" alt="uml diagram"> <ul><li>간접적인 의존
<ul><li>DomScanner와 DomVisitor는 _간접적으로 의존_하고 있다.</li> <li>어쨌든 DomScanner는 DomVisitor를 알고 있어야 한다.</li></ul></li> <li>추상 계층 일치시키기
<ul><li>Scanner와 Visitor의 추상 계층을 동일하게 만들어야 한다.</li> <li>추상 계층이 일치하지 않을 경우, Method의 <strong>변화율</strong>이 달라지게 된다.</li> <li>Method의 변화율이 달라질 경우, 수정이 더욱 빈번하게 발생한다.</li> <li>추상 계층을 일치시키면 수정 대신 <u>기능 추가로 대체</u> 할 수 있다.</li></ul></li></ul> <h3 id="binder"><a href="#binder" class="header-anchor">#</a> Binder</h3> <p>Binder는 상당히 위험한 객체이다.</p> <img src="https://www.plantuml.com/plantuml/svg/VP9D3i8W48Ntd88BS0DZ6dLZeec9IVS8iy2qaC0qNj-6d_9NNPNtCNqCRnWSSelBF171hQGdfINOi7uAhdKI5pDNUbHEeScRbHuLVEv6mjJ8v_9wWy26tfH3A8mZ7lcqGDdL5M4E-c6D0EVISMUZXGMEa3dftEc1iRwJ5jHLUpRisBROUVmfyR8-X18Ia_My23fXxnVYZTzKcJ092QrucrhEZBBL81Ryo2MElMipRSI_MNcp4kRWjvNttPdC05gkp-qB" alt="uml diagram"> <ul><li>Binder는 뻗어나간다.</li> <li>화살표가 뻗어 나가는 것은, 위험한 객체라는 의미다.</li> <li>Binder를 알고 있는 객체를 건드릴 경우 깨질 수 있다.</li> <li>제일 민감하고 예민한 객체가 된다.</li></ul> <h3 id="플랫폼-독립적-구조"><a href="#플랫폼-독립적-구조" class="header-anchor">#</a> 플랫폼 독립적 구조</h3> <p>여태까지 작성한 MVVM System은 플랫폼에 독립적이다.</p> <img src="https://www.plantuml.com/plantuml/svg/VP9D2i8m48NtEKN0TMuWKjIDe208tSTa2f4sWMIArxTj_jf4tMM-lioyladZa5iSXvu8RYKzAYt1-lD3SArZSJP3gEckuzp3LZc59Yj2lL70-sOaz7I6NG4Vu_C50WjwLGuX3KwuvVq8QvSNXC7NTsi4E1UTd8mM5ZX2ujuHgKRGFMErdH9iLT_Qi4Ffi-hnHxAKso6Ka1Ztp7Fw2I_zVFmnzg2CcFYO9fnMcOEZR6eG13zo2M-XiXa_XDji_MThcBUIzp3thTT36j1oUeCV" alt="uml diagram"> <p><u>DomScanner, DomVisitor, ConcreateProcessor 이렇게 세 개만 DOM에 대한 의존성이 있다.</u>
나머지는 <code>ViewModel</code>을 만드는 것들이다. <strong>즉, MVVM의 핵심은 ViewModel을 만드는 것이다.</strong>
그래서 DomScanner, DomVisitor, ConcreateProcessor 등만 교체하면 Android, IOS 에도 사용할 수 있다.</p> <p><strong>이것이 가상화(추상화) 되어 있는 렌더링 시스템이다.</strong></p> <p>설계를 할 때 특정한 Domain과 관련된 부분은 격리를 하는 것을 항상 지향해야 한다.</p> <h2 id="약간의-단점"><a href="#약간의-단점" class="header-anchor">#</a> 약간의 단점</h2> <ul><li>MVVM의 핵심은 Observer Pattern이다.</li> <li>Observer Pattern은 구현과 설계도 어렵고 성능 자체에 대한 비용도 있다.</li></ul> <p>그래서 현실적인 대안으로 MVVM을 사용할 때 Observing을 하는 것 보다 Binder를 수동으로 calling 하는 경우가 생각보다 많다.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/9/2020, 10:06:10 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/TIL/CodeSpitz/Object-Oriented-Javascript/03-Strategy-Observer/" class="prev">MVVM System 개선하기 (1)</a></span> <span class="next"><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/05-Extension/">MVVM System 개선하기 (3)</a>
      →
    </span></p></div>  <div><div id="comment"></div></div></main> <header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <div class="container"><a href="/TIL/" class="home-link router-link-active"><figure><img src="https://avatars1.githubusercontent.com/u/18749057?s=460&amp;v=4" alt="개발자 황준일"></figure> <div><strong>개발자 황준일</strong> <em>Today I Learned</em></div></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/TIL/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/junilhwang/TIL/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Repository
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/TIL/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/junilhwang/TIL/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Repository
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/TIL/" class="sidebar-link">Home</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vuepresse</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Book Review</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>코드스피츠</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>거침없는 자바스크립트</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>객체지향 자바스크립트</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/01-Intro/" class="sidebar-link">객체지향의 기본 이론</a></li><li><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/02-MVVM/" class="sidebar-link">MVVM System 만들기</a></li><li><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/03-Strategy-Observer/" class="sidebar-link">MVVM System 개선하기 (1)</a></li><li><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/04-ISP-Visitor/" class="active sidebar-link">MVVM System 개선하기 (2)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/04-ISP-Visitor/#인터페이스-분리-원칙-isp" class="sidebar-link">인터페이스 분리 원칙 (ISP)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/04-ISP-Visitor/#역할과-책임에-따른-분석" class="sidebar-link">역할과 책임에 따른 분석</a></li><li class="sidebar-sub-header"><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/04-ISP-Visitor/#isp-적용하기" class="sidebar-link">ISP 적용하기</a></li></ul></li><li class="sidebar-sub-header"><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/04-ISP-Visitor/#섬세한-권한-조정" class="sidebar-link">섬세한 권한 조정</a></li><li class="sidebar-sub-header"><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/04-ISP-Visitor/#visitor-pattern" class="sidebar-link">Visitor Pattern</a></li><li class="sidebar-sub-header"><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/04-ISP-Visitor/#추상-계층-일치시키기" class="sidebar-link">추상 계층 일치시키기</a></li><li class="sidebar-sub-header"><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/04-ISP-Visitor/#전체-코드" class="sidebar-link">전체 코드</a></li><li class="sidebar-sub-header"><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/04-ISP-Visitor/#설계-종합" class="sidebar-link">설계 종합</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/04-ISP-Visitor/#viewmodel" class="sidebar-link">ViewModel</a></li><li class="sidebar-sub-header"><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/04-ISP-Visitor/#scanner" class="sidebar-link">Scanner</a></li><li class="sidebar-sub-header"><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/04-ISP-Visitor/#binder" class="sidebar-link">Binder</a></li><li class="sidebar-sub-header"><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/04-ISP-Visitor/#플랫폼-독립적-구조" class="sidebar-link">플랫폼 독립적 구조</a></li></ul></li><li class="sidebar-sub-header"><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/04-ISP-Visitor/#약간의-단점" class="sidebar-link">약간의 단점</a></li></ul></li><li><a href="/TIL/CodeSpitz/Object-Oriented-Javascript/05-Extension/" class="sidebar-link">MVVM System 개선하기 (3)</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>개발환경</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringFramework</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <footer class="siteFooter"><div class="container"><p class="siteFooterCopyright">
      Copyright © 2019 All Right <em>개발자 황준일</em></p> <p class="siteFooterContact">
      tjsdlf4261@gmail.com .
      +82-10-5764-4483 .
      <a href="https://github.com/junilhwang" target="_blank">GitHub</a> .
      <a href="http://junil-hwang.com" target="_blank">Blog</a> .
      <a href="https://github.com/junilhwang/TIL/" target="_blank">Repository</a></p></div></footer></div><div class="global-ui"></div></div>
    <script src="/TIL/assets/js/app.a7579dad.js" defer></script><script src="/TIL/assets/js/3.34eb2dec.js" defer></script><script src="/TIL/assets/js/16.05451e9e.js" defer></script><script src="/TIL/assets/js/2.429b4dd1.js" defer></script>
  </body>
</html>
