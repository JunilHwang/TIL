<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vanilla Javascript로 가상돔(VirtualDOM) 만들기 | 개발자 황준일</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/TIL/assets/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/TIL/assets/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/TIL/assets/favicons/favicon-16x16.png">
    <link rel="manifest" href="/TIL/assets/favicons/site.webmanifest">
    <link rel="mask-icon" href="/TIL/assets/favicons/safari-pinned-tab.svg" color="#3a0839">
    <link rel="shortcut icon" href="/TIL/assets/favicons/favicon.ico">
    <link rel="alternate" type="application/rss+xml" href="https://junilhwang.github.io/TIL/rss.xml" title="개발자 황준일 RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://junilhwang.github.io/TIL/feed.atom" title="개발자 황준일 Atom Feed">
    <link rel="alternate" type="application/json" href="https://junilhwang.github.io/TIL/feed.json" title="개발자 황준일 JSON Feed">
    <meta name="description" content="React와 Vue에서 사용되고 있는 가상돔(VirtualDOM)을 Vanilla JS로 직접 만드는 과정에 대해 소개합니다.">
    <meta name="google-site-verification" content="sHfBWIoCUOYFXJ3b0ulN8jp9jpD8SEW5Wpxvlk-UABA">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="msapplication-config" content="/assets/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/TIL/assets/css/0.styles.3e3259f0.css" as="style"><link rel="preload" href="/TIL/assets/js/app.f27857a7.js" as="script"><link rel="preload" href="/TIL/assets/js/3.eeca1cbc.js" as="script"><link rel="preload" href="/TIL/assets/js/10.1dd4c504.js" as="script"><link rel="prefetch" href="/TIL/assets/js/11.ad34da56.js"><link rel="prefetch" href="/TIL/assets/js/12.72526497.js"><link rel="prefetch" href="/TIL/assets/js/13.0e3f173f.js"><link rel="prefetch" href="/TIL/assets/js/14.6db58cd3.js"><link rel="prefetch" href="/TIL/assets/js/15.5a854507.js"><link rel="prefetch" href="/TIL/assets/js/16.12f8eb88.js"><link rel="prefetch" href="/TIL/assets/js/17.d67fde3d.js"><link rel="prefetch" href="/TIL/assets/js/18.811214b2.js"><link rel="prefetch" href="/TIL/assets/js/19.854800c7.js"><link rel="prefetch" href="/TIL/assets/js/2.2d8dd50e.js"><link rel="prefetch" href="/TIL/assets/js/20.f276807f.js"><link rel="prefetch" href="/TIL/assets/js/21.477d6413.js"><link rel="prefetch" href="/TIL/assets/js/22.8cfd6eb8.js"><link rel="prefetch" href="/TIL/assets/js/23.df20390c.js"><link rel="prefetch" href="/TIL/assets/js/24.9ec1eccf.js"><link rel="prefetch" href="/TIL/assets/js/25.01f3c3cb.js"><link rel="prefetch" href="/TIL/assets/js/26.85fa13a7.js"><link rel="prefetch" href="/TIL/assets/js/27.5b657d28.js"><link rel="prefetch" href="/TIL/assets/js/28.bfa1cbc0.js"><link rel="prefetch" href="/TIL/assets/js/29.ca9df1ca.js"><link rel="prefetch" href="/TIL/assets/js/30.27a87f10.js"><link rel="prefetch" href="/TIL/assets/js/31.4ee8fbbf.js"><link rel="prefetch" href="/TIL/assets/js/32.b179f86b.js"><link rel="prefetch" href="/TIL/assets/js/33.be857bd1.js"><link rel="prefetch" href="/TIL/assets/js/34.508bea9f.js"><link rel="prefetch" href="/TIL/assets/js/35.1f61cdc5.js"><link rel="prefetch" href="/TIL/assets/js/36.825baa6d.js"><link rel="prefetch" href="/TIL/assets/js/37.511410d9.js"><link rel="prefetch" href="/TIL/assets/js/38.d159eaca.js"><link rel="prefetch" href="/TIL/assets/js/39.81420608.js"><link rel="prefetch" href="/TIL/assets/js/4.bb8d195d.js"><link rel="prefetch" href="/TIL/assets/js/40.9ced98f0.js"><link rel="prefetch" href="/TIL/assets/js/41.1787a112.js"><link rel="prefetch" href="/TIL/assets/js/42.3bd199bd.js"><link rel="prefetch" href="/TIL/assets/js/43.e7d891a6.js"><link rel="prefetch" href="/TIL/assets/js/44.773c1134.js"><link rel="prefetch" href="/TIL/assets/js/45.52baa275.js"><link rel="prefetch" href="/TIL/assets/js/46.b97012df.js"><link rel="prefetch" href="/TIL/assets/js/47.98bafc0f.js"><link rel="prefetch" href="/TIL/assets/js/48.44f9c24c.js"><link rel="prefetch" href="/TIL/assets/js/49.c6c993dd.js"><link rel="prefetch" href="/TIL/assets/js/5.dc48688b.js"><link rel="prefetch" href="/TIL/assets/js/50.25387ae5.js"><link rel="prefetch" href="/TIL/assets/js/51.cd9378e4.js"><link rel="prefetch" href="/TIL/assets/js/52.a9e6e3eb.js"><link rel="prefetch" href="/TIL/assets/js/53.7fa0e193.js"><link rel="prefetch" href="/TIL/assets/js/54.c94ded84.js"><link rel="prefetch" href="/TIL/assets/js/55.3754f017.js"><link rel="prefetch" href="/TIL/assets/js/56.46b8a2dd.js"><link rel="prefetch" href="/TIL/assets/js/57.3eed6982.js"><link rel="prefetch" href="/TIL/assets/js/58.82e3e3e0.js"><link rel="prefetch" href="/TIL/assets/js/59.3e42283f.js"><link rel="prefetch" href="/TIL/assets/js/6.a45d4cb3.js"><link rel="prefetch" href="/TIL/assets/js/60.e285fba6.js"><link rel="prefetch" href="/TIL/assets/js/7.1724a4a6.js"><link rel="prefetch" href="/TIL/assets/js/8.e7a3900f.js"><link rel="prefetch" href="/TIL/assets/js/9.e37165ec.js">
    <link rel="stylesheet" href="/TIL/assets/css/0.styles.3e3259f0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><main class="page"> <div class="hit"><img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https://junilhwang.github.io/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/&amp;count_bg=%230099FF&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=%EC%A1%B0%ED%9A%8C%EC%88%98&amp;edge_flat=true" alt="Hits bn"></div> <div class="theme-default-content content__default"><h1 id="vanilla-javascript로-가상돔-virtualdom-만들기"><a href="#vanilla-javascript로-가상돔-virtualdom-만들기" class="header-anchor">#</a> Vanilla Javascript로 가상돔(VirtualDOM) 만들기</h1> <blockquote><p>본 포스트는 React와 Vue에서 사용되고 있는 가상돔(VirtualDOM) 직접 만들어보는 내용이다.
그리고 이 포스트를 읽기 전에 <a href="/TIL/Javascript/Design/Vanilla-JS-Component/">Vanilla Javascript로 웹 컴포넌트 만들기</a>와 <a href="/TIL/Javascript/Design/Vanilla-JS-Store/">Vanilla Javascript로 상태관리 시스템 만들기</a>를 먼저 정독해야 이해하기가 수월하다.</p></blockquote> <p>아마 이 글을 읽는 사람들 대부분은 가상돔(VirtualDOM)의 개념에 대해 이해하고 있으리라 생각한다. 그러니까 어떻게 구현하는지 궁금해서 찾아온게 아닐까?</p> <p>그래도 <s>너무 귀찮지만</s> 개념을 한 번 짚고 넘어가야 한다.</p> <h2 id="_1-브라우저-로딩-과정"><a href="#_1-브라우저-로딩-과정" class="header-anchor">#</a> 1. 브라우저 로딩 과정</h2> <p>VirtualDOM을 이해하기 위해 브라우저의 로딩 과정에 대해 <s>간략하게</s> 알아보자.</p> <p><img src="/TIL/assets/img/1.0b7f117f.png" alt="1.png"></p> <p>브라우저는 <code>파싱</code> → <code>스타일</code> → <code>레이아웃</code> → <code>페인트</code> → <code>합성</code> → <code>렌더</code> 등의 과정을 거친다. 그 후에 JS나 CSS를 통해 DOM이나 CSS에 변화가 생길 경우 reflow 혹은 repaint 등의 과정을 수행한다.</p> <p>한 번 차례대로 알아보자.</p> <h3 id="_1-파싱"><a href="#_1-파싱" class="header-anchor">#</a> (1) 파싱</h3> <p>브라우저가 HTML을 파싱하고 읽어들이는 과정이다.</p> <h4 id="dom-tree"><a href="#dom-tree" class="header-anchor">#</a> DOM Tree</h4> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width,initial-scale=1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>style.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Critical Path<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Hello <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>web performance<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span> students!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>awesome-photo.jpg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><p>HTML을 통해 DOM 객체 트리를 구성한다.</p></li> <li><p>위의 코드는 다음과 같이 해석된다.
<br><img src="/TIL/assets/img/2.839a207a.png" alt="2.png"></p></li> <li><p>나중에 시간이 되면 <strong>HTML을 직접 파싱하는 작업</strong>을 해보길 권유한다.</p> <ul><li><s>무척 재밌다</s></li> <li><s>HTML을 파싱하여 직접 DOM Tree를 구성하는 작업까지 해보면 더 재밌다.</s></li></ul></li></ul> <h4 id="cssom-tree"><a href="#cssom-tree" class="header-anchor">#</a> CSSOM Tree</h4> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">body</span> <span class="token punctuation">{</span> <span class="token property">font-size</span><span class="token punctuation">:</span> 16px <span class="token punctuation">}</span>
<span class="token selector">p</span> <span class="token punctuation">{</span> <span class="token property">font-weight</span><span class="token punctuation">:</span> bold <span class="token punctuation">}</span>
<span class="token selector">span</span> <span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> red <span class="token punctuation">}</span>
<span class="token selector">p span</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> none <span class="token punctuation">}</span>
<span class="token selector">img</span> <span class="token punctuation">{</span> <span class="token property">float</span><span class="token punctuation">:</span> right <span class="token punctuation">}</span>
</code></pre></div><ul><li>외부/내부의 스타일시트의 CSS를 해석해 CSSOM 트리를 구성한다.</li></ul> <p><img src="/TIL/assets/img/3.5388a7d7.png" alt="3.png"></p> <ul><li>body, p, span 등 선택자가 노드로 생성되고 각 노드는 스타일을 참조한다.</li></ul> <h3 id="_2-스타일"><a href="#_2-스타일" class="header-anchor">#</a> (2) 스타일</h3> <p><img src="/TIL/assets/img/4.b55cc847.png" alt="4.png"></p> <ul><li>DOM Tree, CSSOM Tree가 생선되면 스타일을 매칭시켜주는 과정을 거쳐 렌더 트리를 구성한다.</li> <li>렌더링 트리에는 <strong>페이지를 렌더링하는 데 필요한 노드만 포함</strong>된다.</li> <li>참고
<ul><li><code>visibility: hidden</code> <ul><li>요소를 보이지 않게 만든다.</li> <li>여전히 레이아웃에서 공간을 차지</li></ul></li> <li><code>display: none</code> <ul><li>요소가 보이지 않음</li> <li>레이아웃에 포함되지도 않음</li> <li>렌더링 트리에서 요소를 완전히 제거</li></ul></li></ul></li></ul> <h3 id="_3-레이아웃"><a href="#_3-레이아웃" class="header-anchor">#</a> (3) 레이아웃</h3> <ul><li>기기의 뷰포트 내에서 노드의 정확한 위치와 크기를 계산하는 과정</li></ul> <p><img src="data:image/png;base64,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" alt="5.png"></p> <ul><li>경우에 따라 <code>리플로우</code>라고도 함</li> <li>레이아웃 단계에서는 노드의 정확한 위치와 크기를 계산한다.</li> <li><code>%</code>로 지정된 값은, 픽셀 단위로 측정 및 계산된다.</li></ul> <h3 id="_4-페인트"><a href="#_4-페인트" class="header-anchor">#</a> (4) 페인트</h3> <ul><li>렌더링 트리의 각 노드를 화면의 실제 픽셀로 변환하는 마지막 단계</li></ul> <p><img src="/TIL/assets/img/6.8a5fa071.png" alt="6.png"></p> <ul><li>레이아웃이 완료될 때 브라우저가 'Paint Setup' 및 'Paint' 이벤트를 발생</li> <li>렌더링 트리를 화면의 픽셀로 변환</li> <li><code>래스터화</code>라고도 한다.</li> <li><strong>위치와 관계없는</strong> CSS 속성(<code>background-color</code>, <code>opacity</code>, <code>tranform</code>, <code>box-shadow</code> 등)을 적용한다.</li> <li>픽셀로 변환된 결과는 <strong>포토샵의 레이어처럼 생성</strong>되어 개별 레이어로 관리된다.</li></ul> <h3 id="_5-합성-compositing"><a href="#_5-합성-compositing" class="header-anchor">#</a> (5) 합성(Compositing)</h3> <ul><li>화면에 표시하기 위해 페이지에서 페인트된 부분을 합치는 과정</li> <li>쉽게 이야기 하자면, <code>tranform</code> <code>opacity</code> <code>will-change</code> 등을 사용했을 때 합성 과정을 거친다.</li></ul> <img src="/TIL/assets/img/7.83071cb5.png" alt="7" style="width:400px;max-width:100%;"> <ul><li>지금 당장 깊게 이해할 필요는 없다.</li></ul> <h2 id="_2-성능"><a href="#_2-성능" class="header-anchor">#</a> 2. 성능</h2> <h3 id="_1-reflow-repaint"><a href="#_1-reflow-repaint" class="header-anchor">#</a> (1) Reflow, Repaint</h3> <ul><li>앞서 소개한 <code>스타일 → 레이아웃 → 페인트 → 합성</code>을 <strong>렌더링</strong>이라고 한다.</li> <li>이 렌더링 과정은 <strong>상황에 따라 반복하여 발생</strong>할 수 있다.</li> <li><code>Reflow(=Layout)</code>는 다음과 같은 경우에 발생한다.
<ul><li>DOM의 추가/삭제</li> <li>CSS 속성 변경을 통해 <strong>기하학적(높이/넓이/위치 등)인 변화</strong></li> <li>ex) margin, padding, width, height, ...</li></ul></li> <li><code>Repaint(=Paint)</code>는 다음과 같은 경우에 발생한다.
<ul><li>CSS 속성 변경이 <strong>기하학적 변화가 발생하지 않았을 경우</strong></li> <li>ex) color, background, transform, box-shadow, ...</li></ul></li></ul> <h3 id="_2-브라우저에서-제일-성능을-많이-잡아먹는-것"><a href="#_2-브라우저에서-제일-성능을-많이-잡아먹는-것" class="header-anchor">#</a> (2) 브라우저에서 제일 성능을 많이 잡아먹는 것</h3> <ul><li>브라우저는 <code>렌더링 과정</code>에서 성능을 제일 많이 잡아먹는다.</li> <li>특히 <code>Reflow</code>가 순간적으로 많이 발생할 경우 치명적이다.</li></ul> <img src="/TIL/assets/img/8.872694c0.png" alt="8" style="width:600px;max-width:100%;"> <h2 id="_3-가상돔-virtualdom"><a href="#_3-가상돔-virtualdom" class="header-anchor">#</a> 3. 가상돔(VirtualDOM)</h2> <h3 id="_1-가상돔-virtualdom-만들기"><a href="#_1-가상돔-virtualdom-만들기" class="header-anchor">#</a> (1) 가상돔(VirtualDOM) 만들기</h3> <p>이전에 다뤘던 포스트들은 <strong>State</strong>와 <strong>Component</strong>에 대해 소개했다.
이러한 개념이 등장한 이유는 <strong>DOM의 조작에 대한 복잡도</strong>가 날이 갈수록 증가하고 있기 때문이다.
복잡도가 증가한다는 것은 <strong>DOM의 변화가 기하급수적으로 많이 발생</strong>한다는 것이다.</p> <p>그리고 우리는 앞선 내용을 통해서
DOM에 변경이 있을 경우 <strong>렌더트리를 재생성</strong>하고(모든 요소들의 스타일이 다시 계산됨) <strong>레이아웃</strong>을 만들고 <strong>페인팅을 하는 과정</strong>이 다시 <strong>반복</strong>되는 것을 알 수 있었다.
즉, <strong>브라우저가 연산을 많이 해야한다</strong>는 이야기이며, 전체적인 프로세스를 <strong>비효율적</strong>으로 만든다는 것이다.</p> <p><u>그래서 등장한 개념이 가상돔(VirtualDOM) 이다.</u></p> <p>뷰(HTML)에 변화가 있을 때, 구 가상돔(Old Node)과 새 가상돔(New Node)을 비교하여 <strong>변경된 내용만 DOM에 적용</strong>한다.
이를 통해 <strong>브라우저 내에서 발생하는 연산의 양(정확히는 렌더링 과정)을 줄이면서 성능이 개선</strong>되는 것 이다.</p> <p>더 쉽게 말하자면 변화를 모아서 한 번에 처리하는 <strong>일종의 Batch 작업</strong>이다.</p> <img src="/TIL/assets/img/9.ba22e60f.png" alt="9" style="width:600px;max-width:100%;"> <p>그리고 가상돔(VirtualDOM)은 순수 객체로 추상화 되었기 때문에 <strong>브라우저의 종속적이지 않다는 점</strong>도 매력적이다.
그래서 <u>React Native 처럼 React를 이용하여 네이티브 앱을 만들 수 있는</u> 프레임워크도 만들어졌으며 <u>테스트하기도 용이하다.</u></p> <p>가상돔(VirtualDOM)의 개념에 대해 알아봤으니, 이를 <strong>어떻게 사용할 수 있는지</strong> 살펴보자.</p> <ul><li>먼저 <code>RealDOM</code>이 다음과 같이 구성되어 있다고 하자.</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>toggle<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      todo list item 1
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>remove<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>삭제<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>completed<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>toggle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checked</span> <span class="token punctuation">/&gt;</span></span>
      todo list item 2
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>remove<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>삭제<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>추가<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>이에 대한 <code>VirtualDOM</code>은 다음과 같이 구성되어 있을 것이다</li></ul> <div class="language-jsx extra-class"><div class="highlight-lines"><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">virtualDom</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token operator">...</span>children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token operator">:</span> children<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">virtualDom</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'app'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">virtualDom</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token function">virtualDom</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token function">virtualDom</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'checkbox'</span><span class="token punctuation">,</span> className<span class="token operator">:</span> <span class="token string">'toggle'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string">'todo list item 1'</span><span class="token punctuation">,</span>
      <span class="token function">virtualDom</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> className<span class="token operator">:</span> <span class="token string">'remove'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'삭제'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">virtualDom</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> className<span class="token operator">:</span> <span class="token string">'completed'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">virtualDom</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'checkbox'</span><span class="token punctuation">,</span> className<span class="token operator">:</span> <span class="token string">'toggle'</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string">'todo list item 2'</span><span class="token punctuation">,</span>
      <span class="token function">virtualDom</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> className<span class="token operator">:</span> <span class="token string">'remove'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'삭제'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">virtualDom</span><span class="token punctuation">(</span><span class="token string">'form'</span><span class="token punctuation">,</span>
    <span class="token function">virtualDom</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'text'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">virtualDom</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'submit'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'추가'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>보통 <code>virtualDom</code> 대신 <code>h</code> 로 표현한다.</li></ul> <div class="language-jsx extra-class"><div class="highlight-lines"><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token operator">...</span>children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token operator">:</span> children<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'app'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'checkbox'</span><span class="token punctuation">,</span> className<span class="token operator">:</span> <span class="token string">'toggle'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string">'todo list item 1'</span><span class="token punctuation">,</span>
      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> className<span class="token operator">:</span> <span class="token string">'remove'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'삭제'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> className<span class="token operator">:</span> <span class="token string">'completed'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'checkbox'</span><span class="token punctuation">,</span> className<span class="token operator">:</span> <span class="token string">'toggle'</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string">'todo list item 2'</span><span class="token punctuation">,</span>
      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> className<span class="token operator">:</span> <span class="token string">'remove'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'삭제'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'form'</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'text'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'submit'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'추가'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><iframe src="https://junilhwang.github.io/simple-virtual-dom/01-virtual-dom/index.html" width="100%" class="example-frame"></iframe> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li><a href="https://github.com/JunilHwang/simple-virtual-dom/tree/master/01-virtual-dom/index.html" target="_blank" rel="noopener noreferrer">전체코드<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://junilhwang.github.io/simple-virtual-dom/01-virtual-dom/index.html" target="_blank" rel="noopener noreferrer">브라우저에서 확인<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <p>코드를 보면 알겠지만, 가상돔(VirtualDOM)은 거창한게 아니라 <strong>DOM의 형태를 본따 만든 객체 덩어리</strong>다.</p> <p><u>사실 가상돔(VirtualDOM)만 쓴다고해서 드라마틱한 변화가 생기는 것은 아니다.</u>
딱 하나 좋은 점은 RealDOM을 사용하지 않기 때문에 테스트 하기가 용이하다는 점 정도이다.
가령, DOM API는 브라우저에만 존재하는데,
<u>VirtualDOM의 경우 굳이 브라우저 환경이 아니더라도 사용할 수 있는 것이다.</u></p> <h3 id="_2-jsx"><a href="#_2-jsx" class="header-anchor">#</a> (2) JSX</h3> <p>앞서 다룬 가상돔(VirtualDOM)의 문제는 바로 <code>가독성</code>이다. 이를 해결하기 위해 <code>jsx</code>라는 것이 등장했다.</p> <p>먼저 다음과 같은 가상돔(VirtualDOM)을 돔으로 변환하는 <code>createElement</code> 라는 함수가 있다고 가정해보자. 이를 표현해보면 다음과 같다.</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token operator">...</span>children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* 중간 생략 */</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* 중간 생략 */</span> <span class="token punctuation">}</span>

<span class="token function">createElement</span><span class="token punctuation">(</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'app'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'checkbox'</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'toggle'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'todo list item 1'</span><span class="token punctuation">,</span>
        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'remove'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'삭제'</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'completed'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'checkbox'</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'toggle'</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'todo list item 2'</span><span class="token punctuation">,</span>
        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'remove'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'삭제'</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'form'</span><span class="token punctuation">,</span>
      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'text'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'submit'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'추가'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>babel의 <a href="https://babeljs.io/docs/en/babel-plugin-transform-react-jsx" target="_blank" rel="noopener noreferrer">jsx<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>를 이용하면 다음과 같은 문법으로 표현할 수 있다.</p> <blockquote><p>jsx를 적용하기 위해선 babel 관련 패키지를 설치해야하며, 실제 프로덕션 코드로 사용하기 위해서는 다시 es5 코드로 변환하는 <code>트랜스파일링(transfilling)</code> 과정이 필요합니다.</p></blockquote> <div class="language-jsx extra-class"><div class="highlight-lines"><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-jsx"><code><span class="token comment">/** @jsx h */</span>
<span class="token keyword">function</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token operator">...</span>children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* 중간 생략 */</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* 중간 생략 */</span> <span class="token punctuation">}</span>

<span class="token function">createElement</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>toggle<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        todo list item 1
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>remove<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">삭제</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>completed<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>toggle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checked</span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        todo list item 2
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>remove<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">삭제</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">추가</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><iframe src="https://junilhwang.github.io/simple-virtual-dom/02-jsx/index.html" width="100%" class="example-frame"></iframe> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li><a href="https://github.com/JunilHwang/simple-virtual-dom/tree/master/02-jsx/" target="_blank" rel="noopener noreferrer">전체코드<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/JunilHwang/simple-virtual-dom/blob/master/02-jsx/src/main.js" target="_blank" rel="noopener noreferrer">핵심코드<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://junilhwang.github.io/simple-virtual-dom/02-jsx/index.html" target="_blank" rel="noopener noreferrer">브라우저에서 확인<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <p>여기에 <code>state</code> 까지 적용해보자.</p> <div class="language-jsx extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token operator">...</span>children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* 중간 생략 */</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* 중간 생략 */</span> <span class="token punctuation">}</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">createElement</span><span class="token punctuation">(</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'app'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> completed<span class="token punctuation">,</span> content <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> completed <span class="token operator">?</span> <span class="token punctuation">{</span> completed<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'checkbox'</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'toggle'</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> completed <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          content<span class="token punctuation">,</span>
          <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'remove'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'삭제'</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'form'</span><span class="token punctuation">,</span>
      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'text'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'submit'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'추가'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>딱 봐도 가독성이 무척 좋지 않다. 그런데 jsx를 적용하면 다음과 같이 표현할 수 있다.</p> <div class="language-jsx extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-jsx"><code><span class="token comment">/** @jsx h */</span>
<span class="token keyword">function</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token operator">...</span>children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* 중간 생략 */</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* 중간 생략 */</span> <span class="token punctuation">}</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">createElement</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> completed<span class="token punctuation">,</span> content <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>completed <span class="token operator">?</span> <span class="token string">'completed'</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>toggle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checked</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>completed<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token punctuation">{</span> content <span class="token punctuation">}</span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>remove<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">삭제</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">추가</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><iframe src="https://junilhwang.github.io/simple-virtual-dom/03-with-state/index.html" width="100%" class="example-frame"></iframe> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li><a href="https://github.com/JunilHwang/simple-virtual-dom/tree/master/03-with-state/" target="_blank" rel="noopener noreferrer">전체코드<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/JunilHwang/simple-virtual-dom/blob/master/03-with-state/src/main.js" target="_blank" rel="noopener noreferrer">핵심코드<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://junilhwang.github.io/simple-virtual-dom/03-with-state/index.html" target="_blank" rel="noopener noreferrer">브라우저에서 확인<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <p><code>jsx</code>로 표현하니까 훨씬 보기 좋아졌다.</p> <h3 id="_3-virtualdom-→-realdom"><a href="#_3-virtualdom-→-realdom" class="header-anchor">#</a> (3) VirtualDOM → RealDOM</h3> <p>이제 <strong>VirtualDOM을 RealDOM으로 변환하는 과정</strong>이 필요하다. 즉, <code>createElement</code>의 내용을 채워야한다.</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>먼저 <code>node</code>는 <code>tag</code>일 수도 있고, <code>text</code>일 수도 있다.</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> node <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* text일 때 */</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* tag일 때 */</span>
<span class="token punctuation">}</span>
</code></pre></div><p>주석을 코드로 채워보면 다음과 같다.</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> node <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// text node를 만들어서 반환한다.</span>
    <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// tag에 대한 element를 만든다.</span>
  <span class="token keyword">const</span> $el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 정의한 속성을 삽입한다.</span>
  Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>props <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>attr<span class="token punctuation">,</span> value<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>attr<span class="token punctuation">,</span> value<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          $el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>attr<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// node의 children virtual dom을 dom으로 변환한다.</span>
  <span class="token comment">// 즉, 모든 VirtualDOM을 순회한다.</span>
  <span class="token keyword">const</span> children <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>createElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// $el에 변환된 children dom을 추가한다.</span>
  children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> $el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 변환된 dom을 반환한다.</span>
  <span class="token keyword">return</span> $el<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>이렇게 작성된 <code>createElement</code>를 이용하여 VirtaulDOM을 RealDOM으로 만들어보자.</p> <div class="language-jsx extra-class"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-jsx"><code><span class="token comment">/** @jsx h */</span>
<span class="token keyword">function</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token operator">...</span>children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token operator">:</span> children<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> node <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>props <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>attr<span class="token punctuation">,</span> value<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>attr<span class="token punctuation">,</span> value<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          $el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>attr<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> $el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
  node<span class="token punctuation">.</span>childre<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>createElement<span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> $el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> $el<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> realDom <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> completed<span class="token punctuation">,</span> content <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>completed <span class="token operator">?</span> <span class="token string">'completed'</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>toggle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checked</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>completed<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token punctuation">{</span> content <span class="token punctuation">}</span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>remove<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">삭제</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">추가</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>realDom<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><iframe src="https://junilhwang.github.io/simple-virtual-dom/04-create-element/index.html" width="100%" class="example-frame"></iframe> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li><a href="https://github.com/JunilHwang/simple-virtual-dom/tree/master/04-create-element/" target="_blank" rel="noopener noreferrer">전체코드<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/JunilHwang/simple-virtual-dom/blob/master/04-create-element/src/main.js" target="_blank" rel="noopener noreferrer">핵심 코드<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://junilhwang.github.io/simple-virtual-dom/04-create-element/index.html" target="_blank" rel="noopener noreferrer">브라우저에서 확인<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <h3 id="_4-diff-알고리즘-적용"><a href="#_4-diff-알고리즘-적용" class="header-anchor">#</a> (4) Diff 알고리즘 적용</h3> <p>여태까지 기술한 내용의 경우 VirtualDOM을 RealDOM으로 변경하는 과정이고,
성능상의 이점을 가져오기 위해선 <code>Diff 알고리즘</code> 을 통해서 변경된 속성이나 태그에 대해 업데이트 하는 과정이 필요하다.</p> <div class="language-jsx extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-jsx"><code><span class="token comment">/** @jsx h */</span>
<span class="token keyword">function</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token operator">...</span>children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* 중간 생략 */</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* 생략 */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">updateElement</span><span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> newNode<span class="token punctuation">,</span> oldNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* 구현부 */</span> <span class="token punctuation">}</span>

<span class="token keyword">const</span> oldState <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> newState <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 1 update'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 3'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> completed<span class="token punctuation">,</span> content <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>completed <span class="token operator">?</span> <span class="token string">'completed'</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>toggle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checked</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>completed<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token punctuation">{</span> content <span class="token punctuation">}</span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>remove<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">삭제</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">추가</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> oldNode <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>oldState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newNode <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>newState<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> $root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>$root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">updateElement</span><span class="token punctuation">(</span>$root<span class="token punctuation">,</span> oldNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
  <span class="token function">updateElement</span><span class="token punctuation">(</span>$root<span class="token punctuation">,</span> newNode<span class="token punctuation">,</span> oldNode<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token number">1000</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1초 뒤에 DOM 변경</span>
</code></pre></div><p><img src="/TIL/assets/img/11.049f8e52.png" alt="11.png"></p> <p>위의 코드에서 <code>updateElement(parennt, newNode, oldNode)</code> 함수의 내용은 쉽게 말해서 <strong>모든 태그를 비교하여 변경된 부분에 대해 수정/추가/삭제</strong> 하는 것이다.</p> <p>다시 이 내용을 <strong>분할 정복(Divide and conquer)</strong> 해보자.</p> <ol><li>oldNode만 있는 경우(<code>oldNode &amp;&amp; !newNode</code>)
<ul><li>oldNode를 parent에서 제거한다.</li></ul></li> <li>newNode만 있는 경우(<code>!oldNode &amp;&amp; newNode</code>)
<ul><li>newNode를 parent에 추가한다.</li></ul></li> <li>oldNode와 newNode 모두 text 타입일 경우(<code>typeof oldNode === &quot;string&quot; &amp;&amp; typeof newNode === &quot;string&quot;</code>)
<ul><li>oldNode의 내용과 newNode의 내용이 다르다면, oldNode의 내용을 newNode의 내용으로 교체한다.</li></ul></li> <li>oldNode와 newNode의 태그 이름(type)이 다를 경우(<code>oldNode.type !== newNode.type</code>)
<ul><li>둘 중에 하나가 <code>String</code>일 경우에도 해당</li> <li>oldNode를 제거하고, 해당 위치에 newNode를 추가한다.</li></ul></li> <li>oldNode와 newNode의 태그 이름(type)이 똑같을 경우(<code>oldNode.type === newNode.type</code>)
<ul><li>newNode와 oldNode의 attribute를 비교하여 변경된 부분만 반영한다.
<ul><li>oldNode의 attribute 중 newNode에 없는 것은 모두 제거한다.</li> <li>newNode의 attribute에서 변경된 내용만 oldNode의 attribute에 반영한다.</li></ul></li></ul></li> <li><u>newNode와 oldNode의 모든 자식 태그를 순회하며 1 ~ 5의 내용을 반복한다.</u></li></ol> <p>위의 내용을 다시 코드로 간략하게 표현해보자.</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">updateElement</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> newNode<span class="token punctuation">,</span> oldNode<span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. oldNode만 있는 경우</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>newNode <span class="token operator">&amp;&amp;</span> oldNode<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// 2. newNode만 있는 경우</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>newNode <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>oldNode<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// 3. oldNode와 newNode 모두 text 타입일 경우</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> newNode <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> oldNode <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// 4. oldNode와 newNode의 태그 이름(type)이 다를 경우</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>newNode<span class="token punctuation">.</span>type <span class="token operator">!==</span> oldNode<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// 5. oldNode와 newNode의 태그 이름(type)이 같을 경우</span>
  <span class="token function">updateAttributes</span><span class="token punctuation">(</span>
    parent<span class="token punctuation">.</span>childNode<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span>
    newNode<span class="token punctuation">.</span>props<span class="token punctuation">,</span>
    oldNode<span class="token punctuation">.</span>props
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 6. newNode와 oldNode의 모든 자식 태그를 순회하며 1 ~ 5의 내용을 반복한다.</span>
<span class="token punctuation">}</span>

<span class="token comment">// 5 - newNode와 oldNode의 attribute를 비교하여 변경된 부분만 반영한다.</span>
<span class="token keyword">function</span> <span class="token function">updateAttributes</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> newProps<span class="token punctuation">,</span> oldProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>이제 비어있는 코드를 채워보자.</p> <div class="language-jsx extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">updateElement</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> newNode<span class="token punctuation">,</span> oldNode<span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. oldNode만 있는 경우</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>newNode <span class="token operator">&amp;&amp;</span> oldNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> parent<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>childNode<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 2. newNode만 있는 경우</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>newNode <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>oldNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> parent<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 3. oldNode와 newNode 모두 text 타입일 경우</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> newNode <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> oldNode <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newNode <span class="token operator">===</span> oldNode<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> parent<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>
      <span class="token function">createElement</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span><span class="token punctuation">,</span>
      parent<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 4. oldNode와 newNode의 태그 이름(type)이 다를 경우</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>newNode<span class="token punctuation">.</span>type <span class="token operator">!==</span> oldNode<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> parent<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>
      <span class="token function">createElement</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span><span class="token punctuation">,</span>
      parent<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 5. oldNode와 newNode의 태그 이름(type)이 같을 경우</span>
  <span class="token function">updateAttributes</span><span class="token punctuation">(</span>
    parent<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span>
    newNode<span class="token punctuation">.</span>props <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    oldNode<span class="token punctuation">.</span>props <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 6. newNode와 oldNode의 모든 자식 태그를 순회하며 1 ~ 5의 내용을 반복한다.</span>
  <span class="token keyword">const</span> maxLength <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>
    newNode<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
    oldNode<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> maxLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">updateElement</span><span class="token punctuation">(</span>
      parent<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span>
      newNode<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
      oldNode<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
      i
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 5 - newNode와 oldNode의 attribute를 비교하여 변경된 부분만 반영한다.</span>
<span class="token keyword">function</span> <span class="token function">updateAttributes</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> newProps<span class="token punctuation">,</span> oldProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 달라지거나 추가된 Props를 반영</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>attr<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>newProps<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldProps<span class="token punctuation">[</span>attr<span class="token punctuation">]</span> <span class="token operator">===</span> newProps<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
    target<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>attr<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 없어진 props를 attribute에서 제거</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> attr <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>oldProps<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newProps<span class="token punctuation">[</span>attr<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
    target<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>복잡한 로직의 경우 미리 어떤 로직을 만들어야하는지 정의하고 코드를 구성하면 훨씬 구현하기가 쉽다. <s>필자만 그렇게 느끼는건가..?</s></p> <p>어쨌든 위의 코드가 정상적으로 작동하는지 확인해보자.</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">/** @jsx h */</span>
<span class="token keyword">function</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token operator">...</span>children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* 중간 생략 */</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* 생략 */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">updateElement</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> newNode<span class="token punctuation">,</span> oldNode<span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>newNode <span class="token operator">&amp;&amp;</span> oldNode<span class="token punctuation">)</span> <span class="token keyword">return</span> parent<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>childNode<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>newNode <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>oldNode<span class="token punctuation">)</span> <span class="token keyword">return</span> parent<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> newNode <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> oldNode <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newNode <span class="token operator">===</span> oldNode<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> parent<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>
      <span class="token function">createElement</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span><span class="token punctuation">,</span>
      parent<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>newNode<span class="token punctuation">.</span>type <span class="token operator">!==</span> oldNode<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> parent<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>
      <span class="token function">createElement</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span><span class="token punctuation">,</span>
      parent<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">updateAttributes</span><span class="token punctuation">(</span>
    parent<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span>
    newNode<span class="token punctuation">.</span>props <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    oldNode<span class="token punctuation">.</span>props <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> maxLength <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>newNode<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">,</span> oldNode<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> maxLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">updateElement</span><span class="token punctuation">(</span>
      parent<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span>
      newNode<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
      oldNode<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
      i
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">updateAttributes</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> newProps<span class="token punctuation">,</span> oldProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>attr<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>newProps<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldProps<span class="token punctuation">[</span>attr<span class="token punctuation">]</span> <span class="token operator">===</span> newProps<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
    target<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>attr<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> attr <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>oldProps<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newProps<span class="token punctuation">[</span>attr<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
    target<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> oldState <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> newState <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 1 update'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 3'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> completed<span class="token punctuation">,</span> content <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>completed <span class="token operator">?</span> <span class="token string">'completed'</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>toggle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checked</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>completed<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token punctuation">{</span> content <span class="token punctuation">}</span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>remove<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">삭제</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">추가</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> oldNode <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>oldState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newNode <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>newState<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> $root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>$root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">updateElement</span><span class="token punctuation">(</span>$root<span class="token punctuation">,</span> oldNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
  <span class="token function">updateElement</span><span class="token punctuation">(</span>$root<span class="token punctuation">,</span> newNode<span class="token punctuation">,</span> oldNode<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token number">1000</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1초 뒤에 DOM 변경</span>
</code></pre></div><iframe src="https://junilhwang.github.io/simple-virtual-dom/05-diff/index.html" width="100%" class="example-frame"></iframe> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li><a href="https://github.com/JunilHwang/simple-virtual-dom/tree/master/05-diff/" target="_blank" rel="noopener noreferrer">전체코드<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/JunilHwang/simple-virtual-dom/blob/master/05-diff/src/main.js" target="_blank" rel="noopener noreferrer">핵심 코드<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://junilhwang.github.io/simple-virtual-dom/05-diff/index.html" target="_blank" rel="noopener noreferrer">브라우저에서 확인<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <p><img src="/TIL/assets/img/12.57d72a83.png" alt="12.png"> <br><em>개발자 도구에서 확인해보면 변경된 내역에 대해서만 반영 되는 것을 확인할 수 있다.</em></p> <h2 id="_4-virtualdom에-대한-고찰"><a href="#_4-virtualdom에-대한-고찰" class="header-anchor">#</a> 4. VirtualDOM에 대한 고찰</h2> <h3 id="_1-virtualdom이-꼭-필요한가"><a href="#_1-virtualdom이-꼭-필요한가" class="header-anchor">#</a> (1) VirtualDOM이 꼭 필요한가?</h3> <p>Babel이나 Webpack과 함께 VirtualDOM을 사용한다면 사실 특별한 문제는 없다.
그런데 필자가 작성하고 있는 <code>Vanilla Javascript</code> 의 경우, 문제가 된다.
특별한 도구 없이 순수한 JS로 작성할 때 <strong>VirtualDOM의 가독성은 무척 좋지 않기 때문</strong>이다.</p> <p>그리고 사실 <code>Diff 알고리즘</code>만 잘 작성한다면 성능상의 문제는 없을 것이다.</p> <p>그래서 필자는 <strong>RealDOM을 VirtualDOM 처럼 사용해보면 어떨까</strong> 생각해봤다.</p> <div class="language-jsx extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-jsx"><code><span class="token comment">// text를 node로 변환하는 작업이다.</span>
<span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 빈 태그를 하나 만든다.</span>
  <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 안에 내용을 채워넣는다.</span>
  el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;div id=&quot;app&quot;&gt;
      &lt;ul&gt;
        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> completed<span class="token punctuation">,</span> content <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
          &lt;li class=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>completed <span class="token operator">?</span> <span class="token string">'completed'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;
            &lt;input type=&quot;checkbox&quot; class=&quot;toggle&quot; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>completed <span class="token operator">?</span> <span class="token string">'checked'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> /&gt;
            </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>content<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
            &lt;button class=&quot;remove&quot;&gt;삭제&lt;/button&gt;
          &lt;/li&gt;
        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
      &lt;/ul&gt;
      &lt;form&gt;
        &lt;input type=&quot;text&quot; /&gt;
        &lt;button type=&quot;submit&quot;&gt;추가&lt;/button&gt;
      &lt;/form&gt;
    &lt;/div&gt;
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// innerHTML에 등장한 첫 번째 태그를 반환한다.</span>
  <span class="token keyword">return</span> el<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>혹은 이런 방법도 가능하다.</p> <div class="language-jsx extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-jsx"><code><span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  &lt;div id=&quot;app&quot;&gt;
    &lt;ul&gt;
      </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> completed<span class="token punctuation">,</span> content <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
        &lt;li class=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>completed <span class="token operator">?</span> <span class="token string">'completed'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;
          &lt;input type=&quot;checkbox&quot; class=&quot;toggle&quot; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>completed <span class="token operator">?</span> <span class="token string">'checked'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> /&gt;
          </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>content<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
          &lt;button class=&quot;remove&quot;&gt;삭제&lt;/button&gt;
        &lt;/li&gt;
      </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
    &lt;/ul&gt;
    &lt;form&gt;
      &lt;input type=&quot;text&quot; /&gt;
      &lt;button type=&quot;submit&quot;&gt;추가&lt;/button&gt;
    &lt;/form&gt;
  &lt;/div&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token comment">// 외부에서 text를 node로 변환할 수 있다.</span>
<span class="token keyword">const</span> oldNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
oldNode<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>oldState<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> realNode <span class="token operator">=</span> oldNode<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 복제</span>
realNode<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>newState<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 복제된 노드의 내용 변경</span>
</code></pre></div><p>둘 중에 한 가지 방법을 사용하면 되고,
중요한 점은 <strong>DOM을 메모리상에만 올려놓고 값을 변경하는 작업을 하는 것</strong>이다.
이렇게 할 경우 렌더링이 발생하지 않고 메모리에 참조중인 값만 변경하기 때문에 가상돔(VirtualDOM)을 사용하는 것과 별 차이 없다.</p> <h3 id="_2-diff-알고리즘-수정"><a href="#_2-diff-알고리즘-수정" class="header-anchor">#</a> (2) Diff 알고리즘 수정</h3> <p>그리고 이제 RealDOM API를 다루기 때문에 <strong>Diff 알고리즘의 내용을 조금 수정</strong>해야한다.</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">updateElement</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> newNode<span class="token punctuation">,</span> oldNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. oldNode만 있는 경우</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>newNode <span class="token operator">&amp;&amp;</span> oldNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> oldNode<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 2. newNode만 있는 경우</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>newNode <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>oldNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> parent<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 3. oldNode와 newNode 모두 text 타입일 경우</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    <span class="token comment">// typeof가 아니라 instanceof로 직접 비교한다.</span>
    newNode <span class="token keyword">instanceof</span> <span class="token class-name">Text</span> <span class="token operator">&amp;&amp;</span> oldNode <span class="token keyword">instanceof</span> <span class="token class-name">Text</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Text일 경우 nodeValue로 값 비교가 가능하다.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldNode<span class="token punctuation">.</span>nodeValue <span class="token operator">===</span> newNode<span class="token punctuation">.</span>nodeValue<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token comment">// nodeValue의 값을 변경해준다.</span>
    oldNode<span class="token punctuation">.</span>nodeValue <span class="token operator">=</span> newNode<span class="token punctuation">.</span>nodeValue
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 4. oldNode와 newNode의 태그 이름이 다를 경우</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>newNode<span class="token punctuation">.</span>nodeName <span class="token operator">!==</span> oldNode<span class="token punctuation">.</span>nodeName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token operator">...</span>parent<span class="token punctuation">.</span>childNodes <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>oldNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
			oldNode<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	    parent<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newNode<span class="token punctuation">,</span> index<span class="token punctuation">)</span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined를 반환할 것이다.</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 5. oldNode와 newNode의 태그 이름(type)이 같을 경우</span>
  <span class="token comment">// 가상돔(VirtualDOM)의 props를 넘기는게 아니기 때문에 oldNode와 newNode를 직접 넘긴다.</span>
  <span class="token function">updateAttributes</span><span class="token punctuation">(</span>oldNode<span class="token punctuation">,</span> newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 6. newNode와 oldNode의 모든 자식 태그를 순회하며 1 ~ 5의 내용을 반복한다.</span>
  <span class="token comment">// 일단 childNodes를 배열로 변환해야한다.</span>
  <span class="token keyword">const</span> newChildren <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token operator">...</span>newNode<span class="token punctuation">.</span>childNodes <span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">const</span> oldChildren <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token operator">...</span>oldNode<span class="token punctuation">.</span>childNodes <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> maxLength <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>newChildren<span class="token punctuation">.</span>length<span class="token punctuation">,</span> oldChildren<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> maxLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">updateElement</span><span class="token punctuation">(</span>oldNode<span class="token punctuation">,</span> newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> oldChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">updateAttributes</span><span class="token punctuation">(</span><span class="token parameter">oldNode<span class="token punctuation">,</span> newNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> oldProps <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token operator">...</span>oldNode<span class="token punctuation">.</span>attributes <span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> newProps <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token operator">...</span>newNode<span class="token punctuation">.</span>attributes <span class="token punctuation">]</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 달라지거나 추가된 Props를 반영</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span> value<span class="token punctuation">}</span> <span class="token keyword">of</span> newProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> oldNode<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
	  oldNode<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 없어진 props를 attribute에서 제거</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span> <span class="token keyword">of</span> oldProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  <span class="token keyword">if</span> <span class="token punctuation">(</span>newNode<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
	  oldNode<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>전체 코드를 종합해보면 다음과 같다.</p> <div class="language-jsx extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">updateElement</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> newNode<span class="token punctuation">,</span> oldNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>newNode <span class="token operator">&amp;&amp;</span> oldNode<span class="token punctuation">)</span> <span class="token keyword">return</span> oldNode<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>newNode <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>oldNode<span class="token punctuation">)</span> <span class="token keyword">return</span> parent<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>newNode <span class="token keyword">instanceof</span> <span class="token class-name">Text</span> <span class="token operator">&amp;&amp;</span> oldNode <span class="token keyword">instanceof</span> <span class="token class-name">Text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldNode<span class="token punctuation">.</span>nodeValue <span class="token operator">===</span> newNode<span class="token punctuation">.</span>nodeValue<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    oldNode<span class="token punctuation">.</span>nodeValue <span class="token operator">=</span> newNode<span class="token punctuation">.</span>nodeValue
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>newNode<span class="token punctuation">.</span>nodeName <span class="token operator">!==</span> oldNode<span class="token punctuation">.</span>nodeName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token operator">...</span>parent<span class="token punctuation">.</span>childNodes <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>oldNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    oldNode<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    parent<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newNode<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">updateAttributes</span><span class="token punctuation">(</span>oldNode<span class="token punctuation">,</span> newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> newChildren <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token operator">...</span>newNode<span class="token punctuation">.</span>childNodes <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> oldChildren <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token operator">...</span>oldNode<span class="token punctuation">.</span>childNodes <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> maxLength <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>newChildren<span class="token punctuation">.</span>length<span class="token punctuation">,</span> oldChildren<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> maxLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">updateElement</span><span class="token punctuation">(</span>oldNode<span class="token punctuation">,</span> newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> oldChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">updateAttributes</span><span class="token punctuation">(</span><span class="token parameter">oldNode<span class="token punctuation">,</span> newNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span> value<span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token punctuation">[</span> <span class="token operator">...</span>newNode<span class="token punctuation">.</span>attributes <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> oldNode<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
    oldNode<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token punctuation">[</span> <span class="token operator">...</span>oldNode<span class="token punctuation">.</span>attributes <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newNode<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
    oldNode<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> oldState <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> newState <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 1 update'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'todo list item 3'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;div id=&quot;app&quot;&gt;
      &lt;ul&gt;
        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> completed<span class="token punctuation">,</span> content <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
          &lt;li class=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>completed <span class="token operator">?</span> <span class="token string">'completed'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;
            &lt;input type=&quot;checkbox&quot; class=&quot;toggle&quot; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>completed <span class="token operator">?</span> <span class="token string">'checked'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> /&gt;
            </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>content<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
            &lt;button class=&quot;remove&quot;&gt;삭제&lt;/button&gt;
          &lt;/li&gt;
        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
      &lt;/ul&gt;
      &lt;form&gt;
        &lt;input type=&quot;text&quot; /&gt;
        &lt;button type=&quot;submit&quot;&gt;추가&lt;/button&gt;
      &lt;/form&gt;
    &lt;/div&gt;
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> el<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> oldNode <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>oldState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newNode <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>newState<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> $root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>$root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">updateElement</span><span class="token punctuation">(</span>$root<span class="token punctuation">,</span> oldNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
  <span class="token function">updateElement</span><span class="token punctuation">(</span>$root<span class="token punctuation">,</span> newNode<span class="token punctuation">,</span> oldNode<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token number">1000</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1초 뒤에 DOM 변경</span>
</code></pre></div><iframe src="https://junilhwang.github.io/simple-virtual-dom/06-without-vm/index.html" width="100%" class="example-frame"></iframe> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li><a href="https://github.com/JunilHwang/simple-virtual-dom/tree/master/06-without-vm/" target="_blank" rel="noopener noreferrer">전체코드<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/JunilHwang/simple-virtual-dom/blob/master/06-without-vm/src/main.js" target="_blank" rel="noopener noreferrer">핵심 코드<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://junilhwang.github.io/simple-virtual-dom/06-without-vm/index.html" target="_blank" rel="noopener noreferrer">브라우저에서 확인<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <p>이렇게만 사용해도 충분할 것이다.</p> <h2 id="_5-diff-알고리즘-컴포넌트"><a href="#_5-diff-알고리즘-컴포넌트" class="header-anchor">#</a> 5. Diff 알고리즘 + 컴포넌트</h2> <h3 id="_1-컴포넌트-구성"><a href="#_1-컴포넌트-구성" class="header-anchor">#</a> (1) 컴포넌트 구성</h3> <p>앞서 작성한 DIFF 알고리즘을 이용해서 <a href="https://junilhwang.github.io/TIL/Javascript/Design/Vanilla-JS-Component/" target="_blank" rel="noopener noreferrer">Vanilla Javascript로 웹 컴포넌트 만들기<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>를 다시 구성해보자.</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  $target<span class="token punctuation">;</span> $state<span class="token punctuation">;</span>
  
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">$target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>$target <span class="token operator">=</span> $target<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">template</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  
  <span class="token comment">// 여기가 핵심이다.</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> $target <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 기존 Node를 복제한 후에 새로운 템플릿을 채워넣는다.</span>
    <span class="token keyword">const</span> newNode <span class="token operator">=</span> $target<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newNode<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">template</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// DIFF알고리즘을 적용한다.</span>
    <span class="token keyword">const</span> oldChildNodes <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token operator">...</span>$target<span class="token punctuation">.</span>childNodes <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> newChildNodes <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token operator">...</span>newNode<span class="token punctuation">.</span>childNodes <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>oldChildNodes<span class="token punctuation">.</span>length<span class="token punctuation">,</span> newChildNodes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> max<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">updateElement</span><span class="token punctuation">(</span>$target<span class="token punctuation">,</span> newChildNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> oldChildNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 이벤트를 등록한다.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">setEvent</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">setState</span> <span class="token punctuation">(</span><span class="token parameter">newState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>$state<span class="token punctuation">,</span> <span class="token operator">...</span>newState <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>위의 코드를 이용해서 <code>App Component</code>를 만들어보자.</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$state <span class="token operator">=</span> <span class="token punctuation">{</span> items<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'item1'</span><span class="token punctuation">,</span> <span class="token string">'item2'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">template</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> items <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$state<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      &lt;ul&gt;
        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;li&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
      &lt;/ul&gt;
      &lt;button&gt;추가&lt;/button&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">setEvent</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// button을 클릭할 때 마다 state가 변경되고, 렌더링이 실행된다.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$target<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> items <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$state<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> items<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token operator">...</span>items<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">item</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>items<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 컴포넌트 생성</span>
<span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><iframe src="https://junilhwang.github.io/simple-virtual-dom/07-component-with-diff/index.html" width="100%" class="example-frame"></iframe> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li><a href="https://github.com/JunilHwang/simple-virtual-dom/tree/master/07-component-with-diff/" target="_blank" rel="noopener noreferrer">전체코드<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/JunilHwang/simple-virtual-dom/blob/master/07-component-with-diff/src/core/Component.js" target="_blank" rel="noopener noreferrer">핵심 코드<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://junilhwang.github.io/simple-virtual-dom/07-component-with-diff/index.html" target="_blank" rel="noopener noreferrer">브라우저에서 확인<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <h3 id="_2-이벤트-중복등록-해결"><a href="#_2-이벤트-중복등록-해결" class="header-anchor">#</a> (2) 이벤트 중복등록 해결</h3> <p>앞서 작성한 컴포넌트 코드의 경우 실행은 잘 되지만 문제는 <code>렌더링을 할 때 마다 이벤트가 다시 등록</code>된다는 점이다.
기존에는 <strong>렌더링을 할 때 마다 모든 DOM 객체를 제거 한 다음에 다시 렌더링</strong>했다.
그래서 Reflow가 무척 많이 발생하는 것이다.</p> <p>그런데 <strong>이제 변경된 부분에 대해서만 반영</strong>하기 때문에,
기존 태그에 등록된 이벤트가 있을 경우 <strong>이벤트를 해제하고 다시 등록하는 과정</strong>이 필요하다.</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">/**생략**/</span><span class="token punctuation">}</span>
  <span class="token function">template</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">/**생략**/</span><span class="token punctuation">}</span>

  <span class="token comment">// 아이템 추가 메소드</span>
  <span class="token function-variable function">addItem</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> <span class="token punctuation">{</span> items <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$state<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> items<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token operator">...</span>items<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">item</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>items<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 이벤트 등록 메소드</span>
  <span class="token function">setEvent</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// setEvent를 실행할 당시에는 this가 App이 아닌 Component를 가르키게 된다.</span>
    <span class="token comment">// 그래서 setEvent가 실행하는 시점에서 1프레임 이후에 이벤트를 등록/삭제하도록 한다.</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 이벤트 삭제 후 다시 등록</span>
	    <span class="token keyword">const</span> $addButton <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$target<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    $addButton<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>addItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    $addButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>addItem<span class="token punctuation">)</span><span class="token punctuation">;</span> 
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>주석에도 언급했지만, <code>requestAnimationFrame</code>을 사용하는 이유는 <code>this</code>가 binding 되는 시점 때문이다. 이 부분은 Component에 추상화해서 관리하는 것이 좋다.</p> <div class="language-jsx extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br></div><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">$target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*생략*/</span><span class="token punctuation">}</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">template</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*생략*/</span> <span class="token punctuation">}</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/*생략*/</span>
   
    <span class="token comment">// setEvent에 있던 requestAnimationFrame을 이곳으로 옮김</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">setEvent</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">setState</span> <span class="token punctuation">(</span><span class="token parameter">newState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*생략*/</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">/*생략*/</span><span class="token punctuation">}</span>
  <span class="token function">template</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">/*생략*/</span><span class="token punctuation">}</span>
  <span class="token function-variable function">addItem</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">/*생략*/</span><span class="token punctuation">}</span>
  <span class="token function">setEvent</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// requestAnimationFrame 제거</span>
    <span class="token keyword">const</span> $addButton <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$target<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    $addButton<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>addItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
    $addButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>addItem<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><iframe src="https://junilhwang.github.io/simple-virtual-dom/08-refactoring-component-event/index.html" width="100%" class="example-frame"></iframe> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li><a href="https://github.com/JunilHwang/simple-virtual-dom/tree/master/08-refactoring-component-event/" target="_blank" rel="noopener noreferrer">전체코드<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/JunilHwang/simple-virtual-dom/blob/master/08-refactoring-component-event/src/core/Component.js" target="_blank" rel="noopener noreferrer">Component<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/JunilHwang/simple-virtual-dom/blob/master/08-refactoring-component-event/src/App.js" target="_blank" rel="noopener noreferrer">App<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://junilhwang.github.io/simple-virtual-dom/08-refactoring-component-event/index.html" target="_blank" rel="noopener noreferrer">브라우저에서 확인<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <p>사실 고도화 하고자 한다면 더욱 더 복잡해질 것이다. 다른 것 보다 이벤트를 관리하는게 무척 복잡하기 때문이다. 그래서 이 포스팅은 여기까지만 다루도록 하겠다.</p> <h2 id="저장소"><a href="#저장소" class="header-anchor">#</a> 저장소</h2> <ul><li>이 아티클에 사용된 모든 코드는 <a href="https://github.com/JunilHwang/simple-virtual-dom" target="_blank" rel="noopener noreferrer">여기<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>에서 확인할 수 있습니다.</li></ul> <h2 id="summary"><a href="#summary" class="header-anchor">#</a> Summary</h2> <ul><li>브라우저 렌더링 과정에 대해서 이해해야 한다.</li> <li>태그가 변경되면서 기하학적인 변화가 있을 경우에 reflow가 발생하고, reflow는 비용이 매우 크다.</li> <li>reflow를 최소화하기 위해서 가상돔(VirtualDOM)(VirtualDOM)이 등장했다.</li> <li>VirtualDOM의 가독성이 좋지 않기 때문에 JSX라는 것을 사용한다.</li> <li>VirtualDOM 보다 더 중요한 것은 DIFF 알고리즘이다.</li> <li>굳이 VirtualDOM을 사용하지 않아도 된다.</li></ul> <h2 id="reference"><a href="#reference" class="header-anchor">#</a> Reference</h2> <ul><li><a href="https://ui.toast.com/fe-guide/ko_PERFORMANCE#%EC%84%B1%EB%8A%A5-%EC%B5%9C%EC%A0%81%ED%99%94" target="_blank" rel="noopener noreferrer">성능 최적화 | Toast UI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developers.google.com/web/fundamentals/performance/rendering?hl=ko" target="_blank" rel="noopener noreferrer">렌더링 성능 | Google Developers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/constructing-the-object-model?hl=ko" target="_blank" rel="noopener noreferrer">객체 모델 생성 | Google Developers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://velopert.com/3236" target="_blank" rel="noopener noreferrer">[번역] 리액트에 대해서 그 누구도 제대로 설명하기 어려운 것 – 왜 VirtualDOM 인가?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://medium.com/@deathmood/how-to-write-your-own-virtual-dom-ee74acc13060" target="_blank" rel="noopener noreferrer">How to write your own VirtualDOM<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/25/2021, 9:39:33 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/TIL/Javascript/Design/Vanilla-JS-Store/" class="prev">Vanilla Javascript로 상태관리 시스템 만들기</a></span> <span class="next"><a href="/TIL/Javascript/Design/Vanilla-JS-Make-useSate-hook/">Vanilla Javascript로 React UseState Hook 만들기</a>
      →
    </span></p></div>  <div><div id="comment"></div></div></main> <header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TIL/" class="home-link router-link-active"><figure><img src="https://avatars1.githubusercontent.com/u/18749057?s=460&amp;v=4" alt="개발자 황준일"></figure> <div><strong>개발자 황준일</strong> <em>Today I Learned</em></div></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/TIL/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/junilhwang/TIL/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Repository
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/TIL/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/junilhwang/TIL/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Repository
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/TIL/" aria-current="page" class="sidebar-link">Home</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>회고</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Javascript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Domain</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Design</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TIL/Javascript/Design/Vanilla-JS-Component/" class="sidebar-link">Vanilla Javascript로 웹 컴포넌트 만들기</a></li><li><a href="/TIL/Javascript/Design/Vanilla-JS-Store/" class="sidebar-link">Vanilla Javascript로 상태관리 시스템 만들기</a></li><li><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/" aria-current="page" class="active sidebar-link">Vanilla Javascript로 가상돔(VirtualDOM) 만들기</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_1-브라우저-로딩-과정" class="sidebar-link">1. 브라우저 로딩 과정</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_1-파싱" class="sidebar-link">(1) 파싱</a></li><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_2-스타일" class="sidebar-link">(2) 스타일</a></li><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_3-레이아웃" class="sidebar-link">(3) 레이아웃</a></li><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_4-페인트" class="sidebar-link">(4) 페인트</a></li><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_5-합성-compositing" class="sidebar-link">(5) 합성(Compositing)</a></li></ul></li><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_2-성능" class="sidebar-link">2. 성능</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_1-reflow-repaint" class="sidebar-link">(1) Reflow, Repaint</a></li><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_2-브라우저에서-제일-성능을-많이-잡아먹는-것" class="sidebar-link">(2) 브라우저에서 제일 성능을 많이 잡아먹는 것</a></li></ul></li><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_3-가상돔-virtualdom" class="sidebar-link">3. 가상돔(VirtualDOM)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_1-가상돔-virtualdom-만들기" class="sidebar-link">(1) 가상돔(VirtualDOM) 만들기</a></li><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_2-jsx" class="sidebar-link">(2) JSX</a></li><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_3-virtualdom-→-realdom" class="sidebar-link">(3) VirtualDOM → RealDOM</a></li><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_4-diff-알고리즘-적용" class="sidebar-link">(4) Diff 알고리즘 적용</a></li></ul></li><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_4-virtualdom에-대한-고찰" class="sidebar-link">4. VirtualDOM에 대한 고찰</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_1-virtualdom이-꼭-필요한가" class="sidebar-link">(1) VirtualDOM이 꼭 필요한가?</a></li><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_2-diff-알고리즘-수정" class="sidebar-link">(2) Diff 알고리즘 수정</a></li></ul></li><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_5-diff-알고리즘-컴포넌트" class="sidebar-link">5. Diff 알고리즘 + 컴포넌트</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_1-컴포넌트-구성" class="sidebar-link">(1) 컴포넌트 구성</a></li><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_2-이벤트-중복등록-해결" class="sidebar-link">(2) 이벤트 중복등록 해결</a></li></ul></li><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#저장소" class="sidebar-link">저장소</a></li><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#summary" class="sidebar-link">Summary</a></li><li class="sidebar-sub-header"><a href="/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#reference" class="sidebar-link">Reference</a></li></ul></li><li><a href="/TIL/Javascript/Design/Vanilla-JS-Make-useSate-hook/" class="sidebar-link">Vanilla Javascript로 React UseState Hook 만들기</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vuepresse</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Book Review</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>코드스피츠</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>개발환경</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/TIL/Writing/" class="sidebar-link">개발자의 글쓰기</a></li></ul> </aside> <footer class="siteFooter"><div class="container"><p class="siteFooterCopyright">
      Copyright © 2019 All Right <em>개발자 황준일</em></p> <p class="siteFooterContact">
      junil.h@kakao.com .
      +82-10-5764-4483 .
      <a href="https://github.com/junilhwang" target="_blank">GitHub</a> .
      <a href="http://junil-hwang.com" target="_blank">Blog</a> .
      <a href="https://github.com/junilhwang/TIL/" target="_blank">Repository</a></p></div></footer></div><div class="global-ui"></div></div>
    <script src="/TIL/assets/js/app.f27857a7.js" defer></script><script src="/TIL/assets/js/3.eeca1cbc.js" defer></script><script src="/TIL/assets/js/10.1dd4c504.js" defer></script>
  </body>
</html>
